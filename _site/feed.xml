<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>coder_yu&#39;s BLOG</title>
    <description>è¿™é‡Œçš„æ–‡ç« æ’ç‰ˆæ¯”è¾ƒä¸‘ï¼Œæœ‰æ—¶é—´äº†åœ¨æ…¢æ…¢æ•´ç†ï¼Œç®€ä¹¦ä¸Šçš„æ’ç‰ˆä¼šå¥½å¾ˆå¤š~~æ¬¢è¿æŒ‡å‡ºæ–‡ç« ä¸­çš„é”™è¯¯æˆ–è€…ä¸è¶³ä¹‹å¤„.</description>
    <link>http://yourdomain.com/</link>
    <atom:link href="http://yourdomain.com/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Mon, 13 Mar 2017 23:39:50 +0800</pubDate>
    <lastBuildDate>Mon, 13 Mar 2017 23:39:50 +0800</lastBuildDate>
    <generator>Jekyll v3.1.6</generator>
    
      <item>
        <title>å›¾è§£httpsçš„ä¸€äº›å°åŠ¨ä½œ</title>
        <description>&lt;p&gt;çœ‹äº†å¤§åŠå¤©ï¼Œæ€»ç®—å°†httpsçš„æ•´ä¸ªæ¡æ‰‹è¿‡ç¨‹éƒ½çœ‹çš„å·®ä¸å¤šäº†ï¼Œä¹‹å‰ç½‘ä¸Šçœ‹è¿‡å¾ˆå¤šèµ„æ–™ï¼Œæè¿°çš„éƒ½å·®ä¸å¤šï¼Œä¹Ÿè®©æˆ‘å¯¹äºæ•´ä¸ªè¿‡ç¨‹æœ‰ä¸€ä¸ªå¤§è‡´çš„æ¦‚å¿µäº†ï¼Œä½†æ˜¯æˆ‘æƒ³çŸ¥é“çš„ä¸€äº›å…³é”®ç‚¹éƒ½æ²¡è®²å‡ºæ¥ï¼ŒåŸºæœ¬éƒ½æ˜¯ä¸€ç¬”å¸¦è¿‡ï¼Œç„¶åä¹Ÿå°±æ²¡æœ‰å†ç»§ç»­æ‰¾äº†ï¼Œè¿™æ¬¡æƒ³èµ·æ¥ï¼Œåˆé‡æ–°æ‰¾èµ„æ–™ï¼Œæ‰¾åˆ°ä¸¤ç¯‡å¾ˆè¯¦ç»†çš„æ–‡ç« ä»‹ç»äº†ï¼Œå…¶ä¸­ç¬¬äºŒç¯‡è¿˜ä»‹ç»äº†ä¸€äº›ç®—æ³•å±‚æ¬¡çš„å†…å®¹ï¼Œæœ‰å…´è¶£ç ”ç©¶çš„åŒå­¦å¯ä»¥çœ‹çœ‹ï¼Œæˆ‘è¿™è¾¹åªæ˜¯ç¨åšç®€åŒ–å¹¶å°†å®ƒå›¾å½¢åŒ–äº†ï¼Œè®©è¯»è€…æœ‰ä¸€ä¸ªæ›´ç›´è§‚çš„æ„Ÿå—ã€‚&lt;/p&gt;

&lt;p&gt;å‚è€ƒæ–‡ç« ï¼š&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.jianshu.com/p/a766bbf31417&quot;&gt;http://www.jianshu.com/p/a766bbf31417&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://blog.csdn.net/zgwangbo/article/details/50889623&quot;&gt;http://blog.csdn.net/zgwangbo/article/details/50889623&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥poå›¾ï¼š
&lt;img src=&quot;https.png&quot; alt=&quot;https.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å¯¹äºä¹‹å‰äº†è§£è¿‡httpsè¿‡ç¨‹çš„å°ä¼™ä¼´ï¼Œä»”ç»†çœ‹è¿™ä¸ªå›¾åº”è¯¥ä¼šè§£å¼€ä¸€äº›è¿·æƒ‘å§ï¼Œä»”ç»†çœ‹ï¼åŒ…æ‹¬é‚£äº›å­—æ¯å’Œè„šæ ‡ï¼ä½†æ˜¯ï¼æˆ‘è¿˜æ˜¯ç¨å¾®è§£é‡Šä¸‹å§ï¼Œæ¯•ç«Ÿè¿˜æ˜¯è¦å‡‘ç‚¹å­—æ•°çš„â€¦â€¦&lt;/p&gt;

&lt;p&gt;æ¦‚å¿µçš„ä»‹ç»å•¥çš„æˆ‘å°±ä¸è¯´äº†ï¼Œç›´æ¥å¼€å§‹æ­£æ–‡å§ã€‚&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;ClientHelloã€‚ é¦–å…ˆhttpsè¯·æ±‚æ˜¯åŸºäºhttpçš„ï¼Œä¹Ÿå°±æ˜¯åŸºäºtcpçš„ï¼Œæ‰€ä»¥å…ˆå¾—å»ºç«‹tcpä¸‰æ¬¡æ¡æ‰‹ï¼Œè¿™ä¸ªå°±ä¸è¯´äº†ï¼Œç„¶åtcpæ¡æ‰‹åæ˜¯SSLå±‚çš„æ¡æ‰‹ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„ClientHelloæ¶ˆæ¯ï¼Œclientå‘é€æœ¬åœ°æœ€æ–°çš„TLSç‰ˆæœ¬ã€ç®—æ³•ç»„åˆçš„ä¸€ä¸ªé›†åˆå’Œå…¶ä»–å¾ˆå¤šè¾…åŠ©çš„ä¿¡æ¯ï¼Œå¹¶ä¸”ç”Ÿæˆä¸€ä¸ªéšæœºæ•°Aã€‚å…·ä½“çš„å†…å®¹å¯ä»¥çœ‹ä¸‹å›¾ï¼ˆ&lt;code class=&quot;highlighter-rouge&quot;&gt;ClientHello.png&lt;/code&gt;ï¼‰ï¼š
&lt;img src=&quot;ClientHello.png&quot; alt=&quot;ClientHello.png&quot; /&gt;
å¯ä»¥çœ‹åˆ°éšæœºæ•°ï¼ˆ&lt;code class=&quot;highlighter-rouge&quot;&gt;Random&lt;/code&gt;ï¼‰æ˜¯ä¸€ä¸ªGMT UNIXæ—¶é—´åŠ ä¸Šä¸€ä¸²éšæœºå­—èŠ‚ï¼Œç®—æ³•ç»„åˆï¼ˆ&lt;code class=&quot;highlighter-rouge&quot;&gt;Cipher Suite&lt;/code&gt;ï¼‰æœ‰26ç§ã€‚è¿˜æœ‰ClientHelloå¹¶ä¸æ˜¯æˆ‘éšä¾¿å«å«çš„ï¼ŒçœŸçš„å«ClientHelloğŸ˜¢â€¦â€¦&lt;/li&gt;
  &lt;li&gt;ServerHelloã€‚Serveræ”¶åˆ°è¿™äº›ä¿¡æ¯åæ¯”å¯¹è‡ªå·±çš„TLSç‰ˆæœ¬ï¼Œé€‰æ‹©å…¶ä¸­ä½çš„ä¸€ä¸ªä½œä¸ºè¿”å›ï¼Œå¹¶ä¸”ä»ç®—æ³•ç»„åˆçš„é›†åˆä¸­é€‰å‡ºä¸€ç§åˆé€‚çš„ç»„åˆï¼Œç„¶ååŒæ ·ä¹Ÿç”Ÿæˆä¸€ä¸ªéšæœºæ•°Bï¼Œä¸€èµ·æ‰“åŒ…åˆ°ServerHelloä¸­ä¼ å›ç»™Clientã€‚å†…å®¹å¦‚å›¾ï¼ˆ&lt;code class=&quot;highlighter-rouge&quot;&gt;ServerHello.png&lt;/code&gt;ï¼‰ï¼š
&lt;img src=&quot;ServerHello.png&quot; alt=&quot;ServerHello.png&quot; /&gt;
åŒæ ·ServerHelloä¹Ÿä¸æ˜¯éšä¾¿å«çš„ï¼Œå¯ä»¥çœ‹åˆ°éšæœºæ•°æ ¼å¼å’ŒClientHelloä¸€æ ·ï¼Œå¹¶ä¸”è¿™é‡Œé€‰å‡ºäº†ä¸€ç§CipherSuiteç®—æ³•ç»„åˆã€‚&lt;/li&gt;
  &lt;li&gt;Certificatie,ServerHelloDoneã€‚æœåŠ¡ç«¯åœ¨é€‰å‡ºæ²Ÿé€šç­–ç•¥ä¹‹åå°†è‡ªå·±çš„è¯ä¹¦ä¿¡æ¯å‘Šè¯‰Clientç«¯ï¼ˆ&lt;code class=&quot;highlighter-rouge&quot;&gt;Certificate&lt;/code&gt;ï¼‰ï¼Œé€šçŸ¥Clientå…³äºç§˜é’¥æ›´æ–°çš„ä¿¡æ¯ï¼ˆ&lt;code class=&quot;highlighter-rouge&quot;&gt;ServerkeyExchange&lt;/code&gt;ï¼‰ï¼Œæ¥ä¸‹å»å°±çœ‹ä½ çš„äº†ï¼Œå¹¶ä¸”è¡¨ç¤ºè¯¥å‘çš„éƒ½å‘ç»™ä½ äº†ï¼Œæˆ‘çš„Helloç»“æŸäº†ï¼ˆ&lt;code class=&quot;highlighter-rouge&quot;&gt;ServerHelloDone&lt;/code&gt;ï¼‰ã€‚
&lt;img src=&quot;Certificate-ServerHelloDone.png&quot; alt=&quot;Certificate-ServerHelloDone.png&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Clientæ”¶åˆ°2ï¼Œ3æ­¥çš„ä¿¡æ¯åå…ˆéªŒè¯è¯ä¹¦æ˜¯ä¸æ˜¯åˆæ³•çš„ï¼ŒåŒ…æ‹¬å®ƒçš„é¢å‘æœºæ„ï¼ŒåŸŸååŒ¹é…ï¼Œæœ‰é™æœŸé™ç­‰ï¼Œè¿™ä¸ªå…·ä½“çš„è¿‡ç¨‹å°±ä¸æ¢ç©¶äº†ï¼Œåªè¦çŸ¥é“è¿™äº›æ­¥éª¤å°±è¡Œäº†ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;è¯ä¹¦éªŒè¯é€šè¿‡ä¹‹åï¼Œç”Ÿæˆéšæœºæ•°C1,ç„¶åç”¨è¯ä¹¦å†…å®¹ä¸­çš„å…¬é’¥é€šè¿‡æœåŠ¡å™¨é€‰æ‹©çš„éå¯¹ç§°åŠ å¯†ç®—æ³•åŠ å¯†ï¼Œå¾—å‡ºä¸ºC2ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;ç”±ä¹‹å‰çš„ä¸‰ä¸ªéšæœºæ•°Aã€Bã€C1é€šè¿‡ä¸€ä¸ªä¼ªéšæœºå‡½æ•°å†ç”Ÿæˆä¸€ä¸ªDï¼Œ&lt;strong&gt;æ³¨æ„ï¼è¿™ä¸ªæ˜¯æœ€ç»ˆhttpçœŸæ­£ä½¿ç”¨çš„åŠ å¯†ç§˜é’¥ï¼ï¼ï¼&lt;/strong&gt;ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;ç”±Då†æ¬¡é€šè¿‡ä¼ªéšæœºå‡½æ•°ç”Ÿæˆä¸€ä¸ªç§˜é’¥ç»„ï¼ŒåŒ…å«6ä¸ªç§˜é’¥ï¼Œå‡è®¾ä¸ºP1,P2,P3,P4,P5,P6ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;ClientKeyExchangeã€‚é€šçŸ¥Serverç§˜é’¥ç›¸å…³çš„ä¿¡æ¯ï¼Œå‘é€ç¬¬5æ­¥ä¸­ç®—å‡ºçš„C2ç»™Serverç«¯ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;Clientç«¯å‘é€ClientKeyExchangeä¹‹åï¼Œè®¡ç®—ä¹‹å‰æ‰€æœ‰ä¸Serverç«¯äº¤äº’æ¶ˆæ¯çš„hashå€¼ï¼Œå‡è®¾ä¸ºclient_hash1ï¼Œç”¨æ­¥éª¤7ä¸­å¾—åˆ°çš„å…¶ä¸­ä¸€ä¸ªP1è¿›è¡ŒåŠ å¯†ï¼Œç»“æœä¸ºEã€‚&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Serverç«¯æ”¶åˆ°C2åç”¨ç§é’¥ç»“åˆéå¯¹ç§°ç®—æ³•è§£å¯†C2ï¼Œå¾—åˆ°C1ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;åŒæ ·çš„Serverç«¯ä¹Ÿæ ¹æ®Aã€Bã€C1ç”±ä¼ªéšæœºå‡½æ•°ç”ŸæˆD(&lt;strong&gt;æœ€ç»ˆçš„åŠ å¯†ç§˜é’¥ï¼ï¼ï¼&lt;/strong&gt;),å†ç”±Då¾—å‡ºç§˜ç»„é’¥ï¼ˆP1-P6ï¼‰ï¼Œå› ä¸ºè¿™é‡Œæ¶‰åŠåˆ°çš„ç®—æ³•éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥å¾—å‡ºçš„ç§˜é’¥ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Serverç«¯è®¡ç®—ä¹‹å‰æ‰€æœ‰å’ŒClientç«¯äº¤äº’æ¶ˆæ¯çš„hashå€¼ï¼Œå‡è®¾ä¸ºserver_hash2ï¼Œå¤§å®¶å¯èƒ½å‘ç°äº†ï¼Œ11ã€12è·ŸClientç«¯çš„6ã€7ã€9è¿‡ç¨‹ä¸€è‡´ï¼Œåªæ˜¯å°‘äº†9ä¸­çš„P1åŠ å¯†è¿‡ç¨‹ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;è¿™ä¸ªæ—¶å€™Clientç«¯ä¼šå‘é€ChangeCipherSpecæ¶ˆæ¯å’ŒEncryptedHandshakeMessageæ¶ˆæ¯ï¼Œé€šçŸ¥Serverç«¯æ¥ä¸‹å»ä½¿ç”¨é€‰å®šçš„åŠ å¯†ç­–ç•¥æ¥é€šä¿¡äº†ï¼Œå¹¶ä¸”å°†ç¬¬9æ­¥ä¸­çš„Eä¼ ç»™äº†Serverã€‚ï¼ˆè¿™é‡Œå‡ ä¸ªæ­¥éª¤çš„é¡ºåºåªæ˜¯ä¸ºäº†å¥½ç†è§£ä¸€ç‚¹è€Œè¿™æ ·æ’åˆ—ï¼Œå®é™…ä¸¤æ¡çº¿æ˜¯ç‹¬ç«‹åœ¨å¤„ç†ä¿¡æ¯çš„ï¼Œæ‰€ä»¥å…ˆåé¡ºåºä¸èƒ½ä¿è¯ï¼‰&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;è¿™ä¸ªæ—¶å€™Clientä¼šå†æ¬¡è®¡ç®—ä¹‹å‰æ¡æ‰‹æ¶ˆæ¯çš„hashå€¼ï¼Œå¾—å‡ºç»“æœclient_hash2ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Serveråœ¨æ”¶åˆ°EncryptedHandshakeMessageæ¶ˆæ¯å¸¦è¿‡æ¥çš„Eä¹‹åï¼Œåˆ©ç”¨æ­¥éª¤11ä¸­çš„P1è§£å¯†Eï¼Œç”±äºåŠ å¯†ç®—æ³•å’ŒP1éƒ½æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥è¿™é‡Œè¿˜åŸå‡ºäº†client_hash1ï¼Œç„¶åä¸æ­¥éª¤12ä¸­çš„server_hash2æ¯”å¯¹ï¼Œå¦‚æœä¸€æ ·è¯´æ˜ä¹‹å‰çš„å‡ æ¡åå•†ç§˜é’¥çš„æ¶ˆæ¯éƒ½è¢«å¯¹æ–¹æ­£ç¡®æ— è¯¯çš„ç†è§£äº†ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Serverç«¯å†æ¬¡å¯¹ä¹‹å‰çš„æ¶ˆæ¯åšhashå€¼ï¼Œå¾—å‡ºserver_hash2ï¼Œç”¨P2è¿›è¡ŒåŠ å¯†ç»“æœä¸ºFï¼Œç„¶åé€šè¿‡ChangeCipherSpec-EncryptedHandshakeMessageæ¶ˆæ¯ä¼ ç»™Clientç«¯ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;Clientæ”¶åˆ°Serverçš„æ¶ˆæ¯åæ ¹æ®P2è§£å¯†Fè¿˜åŸå¾—å‡ºserver_hash2ï¼Œä¸client_hash2æ¯”å¯¹å¦‚æœä¸€è‡´ï¼Œåˆ™è®¤ä¸ºä¹‹å‰çš„äº¤äº’è¿‡ç¨‹éƒ½æ˜¯æ­£ç¡®æ— è¯¯ä¸”è¢«å¯¹æ–¹ç†è§£çš„ã€‚è‡³æ­¤ï¼Œæ•´ä¸ªæ¡æ‰‹è¿‡ç¨‹å°±ç»“æŸäº†ï¼Œä¹‹åçš„httpæ•°æ®æŠ¥å°±ä¼šè¢«ä¹‹å‰ç¡®å®šçš„åŠ å¯†ç­–ç•¥å’ŒåŠ å¯†ç§˜é’¥Dè¿›è¡ŒåŠ å¯†ä¼ è¾“äº†ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;æ€»ç»“ï¼šå…¶å®æœ€ç»ˆæˆ‘ä»¬å‘ç°æ•´ä¸ªæ¡æ‰‹è¿‡ç¨‹ä¸­å¹¶æ²¡æœ‰ç›´æ¥ä¼ è¾“æœ€ç»ˆçš„åŠ å¯†ç§˜é’¥Dï¼Œè€Œä¸”äº¤æ¢äº†ä¸€äº›ç®—æ³•ç­–ç•¥å’Œç”ŸæˆDçš„ä¸€äº›å‚æ•°ï¼Œè¿™æ ·ç›¸å¯¹æ¥è¯´ä¼šæ›´å®‰å…¨ä¸€ç‚¹ï¼Œç›´æ¥ä¼ Dçš„è¯è¿™ä¸ªè¿‡ç¨‹å°±ç”±Clientç«¯å®Œæˆäº†ï¼Œä¸­é—´å¦‚æœå‡ºä»€ä¹ˆå·®é”™Serverä¼šæ— æ„ŸçŸ¥æ— æ¡ä»¶çš„ä¿¡ä»»Clientä¼ è¿‡æ¥çš„Dï¼Œå°±æœ‰å¯èƒ½å‡ºç°é—®é¢˜äº†ï¼Œæ‰€ä»¥é‡‡ç”¨åªä¼ ç­–ç•¥å’Œå‚æ•°ï¼Œå¹¶ä¸”ç”±åŒæ–¹å…±åŒå‚ä¸ï¼Œè¿™æ ·å®‰å…¨æ€§å’Œæ­£ç¡®æ€§å°±ä¼šæé«˜å¾ˆå¤šã€‚è´´ä¸€å¼ æ•´ä¸ªè¿‡ç¨‹çš„æŠ“åŒ…å›¾ä½œä¸ºç»“å°¾å§~
&lt;img src=&quot;æ¡æ‰‹æ¶ˆæ¯è¿‡ç¨‹.png&quot; alt=&quot;æ¡æ‰‹æ¶ˆæ¯è¿‡ç¨‹.png&quot; /&gt;&lt;/p&gt;
</description>
        <pubDate>Mon, 13 Mar 2017 23:10:00 +0800</pubDate>
        <link>http://yourdomain.com/blog/2017/03/13/https.html</link>
        <guid isPermaLink="true">http://yourdomain.com/blog/2017/03/13/https.html</guid>
        
        
        <category>Blog</category>
        
      </item>
    
      <item>
        <title>Androidæ¶ˆæ¯åˆ†å‘åŠå¤šçº¿ç¨‹åˆ‡æ¢ä¹‹Handlerã€Messageçš„ç»†ææœ«èŠ‚ï¼ˆäºŒï¼‰</title>
        <description>&lt;p&gt;ä¹‹å‰è¯´äº†Androidæ¶ˆæ¯åˆ†å‘å’Œå¤šçº¿ç¨‹åˆ‡æ¢çš„æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼Œè¿™æ¬¡æ¥è¯´ä¸€ä¸‹æ¶ˆæ¯ä¼ é€’çš„æ•´ä¸ªè¿‡ç¨‹ï¼Œå¥½åƒä¸Šä¸€ç¯‡å†…å®¹ä¸çœ‹è²Œä¼¼ä¹Ÿå¯ä»¥ç›´æ¥çœ‹è¿™ç¯‡ï¼Œä¸è¿‡å»ºè®®è¿˜æ˜¯çœ‹ä¸€ä¸‹å¯ä»¥äº†è§£çš„æ›´é€å½»ä¸€ç‚¹å§~~&lt;/p&gt;

&lt;p&gt;ä¸Šä¸€ç¯‡è¯·çœ‹ï¼šhttp://www.jianshu.com/p/e914cda1b5fe&lt;/p&gt;

&lt;p&gt;ä¸‹é¢å¼€å§‹æœ¬ç¯‡çš„ä¸»é¢˜å§ï¼Œæˆ‘å°†æŒ‰ç…§Handlerå’ŒMessageçš„ä¸€èˆ¬ä½¿ç”¨æµç¨‹ï¼Œè·Ÿç€ä»£ç è°ƒç”¨é“¾ä¸€æ­¥æ­¥å¾€ä¸‹èµ°ï¼Œæ‰€ä»¥ï¼Œçœ‹ä»£ç å§ï¼&lt;/p&gt;

&lt;p&gt;é¦–å…ˆåœ¨ä¸»çº¿ç¨‹å®šä¹‰ä¸€ä¸ªhandlerï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;	Handler handler = new Handler(){
            @Override
            public void handleMessage(Message msg) {
                super.handleMessage(msg);
                switch (msg.what){
                    case TEST:
                        handleTest(msg);
                        break;
                    default:
                        handleDefault(msg);
                        break;
                }
            }
       };
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;ç„¶ååœ¨å·¥ä½œçº¿ç¨‹ä¸­ä½¿ç”¨æ‹¿åˆ°handlerçš„å¼•ç”¨ï¼Œç›´æ¥ä½¿ç”¨ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;	new Thread(){
            @Override
            public void run() {
                super.run();
                Message message = Message.obtain();
                message.what = TEST;
                Bundle bundle =new Bundle();
                bundle.putString(&quot;test key&quot;,&quot;test value&quot;);
                message.setData(bundle);
       			handler.sendMessage(msg);                
            }
        }.start();
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;ä»¥ä¸Šå³ä¸ºä¸€ä¸ªç®€å•ä½¿ç”¨åœºæ™¯ï¼Œåœ¨å·¥ä½œçº¿ç¨‹ä¸­é€šè¿‡å°†Messageå‘é€åˆ°ä¸»çº¿ç¨‹çš„handlerï¼Œè®©handleråœ¨ä¸»çº¿ç¨‹ä¸­å¤„ç†UIç›¸å…³çš„æ“ä½œã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬ä»ç¬¬ä¸€æ®µä»£ç å¼€å§‹ï¼Œå…ˆçœ‹ä¸€ä¸‹Handlerçš„åˆ›å»ºè¿‡ç¨‹ã€‚å¾ˆç®€å•ï¼Œç›´æ¥newä¸€ä¸ªHandlerå¯¹è±¡ï¼Œç„¶åå®ç°å®ƒçš„&lt;strong&gt;handleMessage(Message msg)&lt;/strong&gt;æ–¹æ³•ï¼Œä½†æ˜¯è¿™ä¸ªhandlerå¯ä¸æ˜¯éšä¾¿å“ªé‡Œéƒ½èƒ½åˆ›å»ºçš„ï¼Œç›¸ä¿¡å¾ˆå¤šåŒå­¦è‚¯å®šä¹Ÿç¢°åˆ°è¿‡åœ¨åˆ«çš„çº¿ç¨‹ä¸­åˆ›å»ºhandleræŠ¥é”™çš„æƒ…å†µï¼Œç±»ä¼¼&lt;code class=&quot;highlighter-rouge&quot;&gt;Can&#39;t create handler inside thread that has not called Looper.prepare()&lt;/code&gt;è¿™æ ·çš„é”™è¯¯æç¤ºï¼Œä¸ºå•¥å‘¢ï¼Ÿ&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;	/**
     * Default constructor associates this handler with the {@link Looper} for the
     * current thread.
     *
     * If this thread does not have a looper, this handler won&#39;t be able to receive messages
     * so an exception is thrown.
     */
    public Handler() {
        this(null, false);
    }
    
   
    public Handler(Callback callback, boolean async) {
        if (FIND_POTENTIAL_LEAKS) {
            final Class&amp;lt;? extends Handler&amp;gt; klass = getClass();
            if ((klass.isAnonymousClass() || klass.isMemberClass() || klass.isLocalClass()) &amp;amp;&amp;amp;
                    (klass.getModifiers() &amp;amp; Modifier.STATIC) == 0) {
                Log.w(TAG, &quot;The following Handler class should be static or leaks might occur: &quot; +
                    klass.getCanonicalName());
            }
        }

        mLooper = Looper.myLooper();
        if (mLooper == null) {
            throw new RuntimeException(
                &quot;Can&#39;t create handler inside thread that has not called Looper.prepare()&quot;);
        }
        mQueue = mLooper.mQueue;
        mCallback = callback;
        mAsynchronous = async;
    }
    
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;æœ€ç»ˆè°ƒç”¨åˆ°çš„æ„é€ å™¨ä¸­çš„ç¬¬ä¸€å¤„åˆ¤æ–­æ˜¯ç”¨æ¥æ£€æµ‹å†…å­˜æ³„éœ²ç›¸å…³çš„ï¼Œæˆ‘ä»¬ä¸ç®¡ï¼Œçœ‹&lt;strong&gt;mLooper&lt;/strong&gt;å˜é‡çš„èµ‹å€¼ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;	/**
     * Return the Looper object associated with the current thread.  Returns
     * null if the calling thread is not associated with a Looper.
     */
    public static @Nullable Looper myLooper() {
        return sThreadLocal.get();
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;sThreadLocal.get()&lt;/strong&gt;æ–¹æ³•ä¸Šä¸€ç¯‡æˆ‘ä»¬è®²è¿‡äº†ï¼Œ&lt;strong&gt;sThreadLocal&lt;/strong&gt;æ˜¯ä¸€ä¸ªå…¨å±€çš„é™æ€å˜é‡ï¼Œä¿å­˜ç€çº¿ç¨‹å¯¹åº”çš„&lt;strong&gt;looper&lt;/strong&gt;å¯¹è±¡ï¼Œ&lt;strong&gt;get()&lt;/strong&gt;æ–¹æ³•ç”¨æ¥è·å–å½“å‰çº¿ç¨‹å¯¹åº”çš„&lt;strong&gt;looper&lt;/strong&gt;å¯¹è±¡ï¼Œç”±äºæˆ‘ä»¬è¿™ä¸ª&lt;strong&gt;handler&lt;/strong&gt;æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­åˆ›å»ºçš„ï¼Œè€Œä¸»çº¿ç¨‹åœ¨&lt;strong&gt;ActivityThread&lt;/strong&gt;çš„&lt;strong&gt;main()&lt;/strong&gt;æ–¹æ³•ä¸­å·²ç»ä¸ºæˆ‘ä»¬åˆ›å»ºäº†å¯¹åº”çš„&lt;strong&gt;looper&lt;/strong&gt;å¯¹è±¡ï¼Œå› æ­¤æˆ‘ä»¬è¿™é‡Œå»getçš„è¯æ˜¯èƒ½å–åˆ°å€¼çš„ï¼Œæ‰€ä»¥ä¸‹é¢ä¸€è¡Œçš„åˆ¤æ–­ä¸ä¼šæŠ›å¼‚å¸¸ã€‚ä½†æ˜¯ä¸€èˆ¬çš„å·¥ä½œçº¿ç¨‹ï¼Œæˆ‘ä»¬å¦‚æœæ²¡ç”¨ä¸ºå®ƒåˆ›å»º&lt;strong&gt;Looper&lt;/strong&gt;å¯¹è±¡ï¼Œå®ƒæ˜¯æ²¡æœ‰å¯¹åº”çš„&lt;strong&gt;Looper&lt;/strong&gt;å¯¹è±¡ä¿å­˜åœ¨&lt;strong&gt;sThreadLocal&lt;/strong&gt;ä¸­çš„ï¼Œå› æ­¤&lt;strong&gt;Looper.myLooper()&lt;/strong&gt;å°±ä¼šè¿”å›nullï¼Œæ¥ä¸‹å»å°±ä¼šæŠ¥é”™ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢è¯´çš„åœ¨å·¥ä½œçº¿ç¨‹ä¸­åˆ›å»ºhandlerä¼šæŠ¥é”™çš„åŸå› ã€‚å–åˆ°&lt;strong&gt;mLooper&lt;/strong&gt;ä¹‹åï¼Œå°†&lt;strong&gt;mLooper&lt;/strong&gt;ä¸­çš„ä¿å­˜&lt;strong&gt;Message&lt;/strong&gt;çš„&lt;strong&gt;MessageQueue&lt;/strong&gt;ä¹Ÿå–å‡ºä¿å­˜åœ¨&lt;strong&gt;handler&lt;/strong&gt;çš„å±æ€§&lt;strong&gt;mQueue&lt;/strong&gt;ä¸­ï¼Œç„¶åå°†æ„é€ å™¨çš„å‚æ•°&lt;strong&gt;callback&lt;/strong&gt;å’Œ&lt;strong&gt;async&lt;/strong&gt;èµ‹å€¼ï¼Œæˆ‘ä»¬è¿™é‡Œéƒ½ä¸ºnullã€‚&lt;/p&gt;

&lt;p&gt;è¿™é‡Œå¤§è‡´ä»‹ç»ä¸‹&lt;strong&gt;Handler&lt;/strong&gt;çš„å‡ ä¸ªå±æ€§ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;boolean mAsynchronousï¼š&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;è¿™ä¸ªæ˜¯ç”¨æ¥è¡¨æ˜å¤„ç†&lt;strong&gt;Message&lt;/strong&gt;çš„æ—¶å€™æ˜¯å¦éœ€è¦ä¿è¯é¡ºåºï¼Œé»˜è®¤ä¸ºfalseï¼Œè€Œä¸”æˆ‘ä»¬å…¶å®ä¹Ÿæ²¡åŠæ³•å»å°†ä»–è®¾ç½®ä¸ºtrueï¼Œå› ä¸ºè¿™äº›æ„é€ å™¨éƒ½æ˜¯&lt;code class=&quot;highlighter-rouge&quot;&gt;@hide&lt;/code&gt;çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¸ç®¡å®ƒã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Callback mCallbackï¼š&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;è¿™ä¸ªæ˜¯Handlerçš„å†…éƒ¨æ¥å£&lt;strong&gt;Callback&lt;/strong&gt;ç±»å‹çš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒå°±ä¸€ä¸ªæ–¹æ³•ï¼Œä¹Ÿå«
&lt;strong&gt;handleMessage(Message msg)&lt;/strong&gt;,åªèƒ½åœ¨æ„é€ å™¨ä¸­ä¼ å‚ï¼Œå¦‚æœæˆ‘ä»¬åœ¨æ„é€ å™¨ä¸­ç»™äº†è¿™ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆå‘é€ç»™è¿™ä¸ª&lt;strong&gt;handler&lt;/strong&gt;çš„æ¶ˆæ¯å°†ä¼˜å…ˆä¼šç”±è¿™ä¸ª&lt;strong&gt;mCallback&lt;/strong&gt;æ¥æ‰§è¡Œï¼Œä¸è¿‡ç›®å‰ä¸ºæ­¢æˆ‘å¹¶ä¸æ¸…æ¥šå“ªäº›åœºæ™¯é€‚ç”¨è¿™ç§æ–¹å¼ï¼ŒçŸ¥é“çš„åŒå­¦æ¬¢è¿æŒ‡æ•™ä¸€ä¸‹~&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Looper mLooper:&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;handler&lt;/strong&gt;æ˜¯ç”¨æ¥å¤„ç†&lt;strong&gt;Message&lt;/strong&gt;çš„ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»è¦æœ‰&lt;strong&gt;Message&lt;/strong&gt;æ¥æºï¼Œè€Œ&lt;strong&gt;Message&lt;/strong&gt;çš„æ¥æº&lt;strong&gt;MessageQueue&lt;/strong&gt;æ˜¯åœ¨&lt;strong&gt;Looper&lt;/strong&gt;ä¸­çš„ï¼Œå› æ­¤&lt;strong&gt;handler&lt;/strong&gt;éœ€è¦ä¸€ä¸ª&lt;strong&gt;Looper&lt;/strong&gt;å±æ€§ã€‚ä¸€èˆ¬æƒ…å†µä¸‹&lt;strong&gt;mLooper&lt;/strong&gt;å³ä¸ºä¸»çº¿ç¨‹æˆ–è€…è¯´æ˜¯åˆ›å»ºå®ƒçš„çº¿ç¨‹æ‰€å¯¹åº”çš„&lt;strong&gt;Looper&lt;/strong&gt;,ä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¼ ä¸€ä¸ªLooperå¯¹è±¡ç»™å®ƒï¼Œå…³äºè¿™ä¸ªå¯ä»¥çœ‹çœ‹&lt;code class=&quot;highlighter-rouge&quot;&gt;HandlerThread&lt;/code&gt;çš„ç›¸å…³çŸ¥è¯†ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;MessageQueue mQueueï¼š&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;æ²¡å•¥å¥½è¯´çš„ï¼Œè¿™ä¸ªå°±æ˜¯&lt;strong&gt;handler&lt;/strong&gt;è¦å¤„ç†çš„æ¶ˆæ¯çš„æ¥æºäº†,å®ƒå’Œ&lt;strong&gt;Looper&lt;/strong&gt;ä¸­çš„&lt;strong&gt;mQueue&lt;/strong&gt;æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;åœ¨çœ‹ä¸€ä¸‹&lt;strong&gt;Handler&lt;/strong&gt;çš„æ¶ˆæ¯åˆ†å‘æ–¹æ³•ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;	/**
     * Handle system messages here.
     */
    public void dispatchMessage(Message msg) {
        if (msg.callback != null) {
            handleCallback(msg);
        } else {
            if (mCallback != null) {
                if (mCallback.handleMessage(msg)) {
                    return;
                }
            }
            handleMessage(msg);
        }
    }
    
    private static void handleCallback(Message message) {
        message.callback.run();
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;è¿˜è®°å¾—ä¸Šä¸€ç¯‡ä¸­æœ€åçº¿ç¨‹åœç•™çš„é‚£ä¸ªæ­»å¾ªç¯å—ï¼Œé‡Œé¢æœ‰ä¸€è¡Œä»£ç &lt;code class=&quot;highlighter-rouge&quot;&gt; msg.target.dispatchMessage(msg);&lt;/code&gt;,è¿™é‡Œæ¯æ¬¡å–å‡ºçš„&lt;strong&gt;Message&lt;/strong&gt;éƒ½ä¼šè¢«å®ƒå¯¹åº”çš„&lt;strong&gt;target&lt;/strong&gt;ä¹Ÿå°±æ˜¯&lt;strong&gt;Handler&lt;/strong&gt;å¯¹è±¡åˆ†å‘ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢è¿™æ®µä»£ç ã€‚&lt;/p&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ°é¦–å…ˆä¼šåˆ¤æ–­&lt;strong&gt;Message&lt;/strong&gt;å¯¹è±¡è‡ªå·±çš„&lt;strong&gt;callback&lt;/strong&gt;æ˜¯å¦ä¸ºç©ºï¼Œå®ƒæ˜¯ä¸€ä¸ª&lt;strong&gt;Runnable&lt;/strong&gt;å¯¹è±¡ï¼Œå¦‚æœä¸ä¸ºç©ºç›´æ¥è°ƒç”¨&lt;strong&gt;callback&lt;/strong&gt;çš„&lt;strong&gt;run()&lt;/strong&gt;æ–¹æ³•ï¼Œå¦åˆ™åˆ¤æ–­&lt;strong&gt;handler&lt;/strong&gt;çš„å±æ€§&lt;strong&gt;mCallback&lt;/strong&gt;æ˜¯å¦ä¸ºç©ºï¼Œå±æ€§ä»‹ç»çš„æ—¶å€™å·²ç»è®²è¿‡è¿™ä¸ªäº†ï¼Œå¦‚æœä¸ä¸ºç©ºåˆ™åˆ™è°ƒç”¨&lt;strong&gt;mCallback.handleMessage(msg)&lt;/strong&gt;æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›trueå°±ç›´æ¥returnï¼Œå¦åˆ™è°ƒç”¨&lt;strong&gt;handler&lt;/strong&gt;çš„&lt;strong&gt;handlerMessage(msg)&lt;/strong&gt;æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¦ç»§æ‰¿&lt;strong&gt;Handler&lt;/strong&gt;è¦å®ç°çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ˜¯ä¸æ˜¯æœ‰ç‚¹ç±»ä¼¼äºAndroidç³»ç»Ÿçš„å±å¹•äº‹ä»¶ä¼ é€’æœºåˆ¶å‘¢ï¼Ÿå“ˆå“ˆ~&lt;/p&gt;

&lt;p&gt;è¯è¯´ç¬¬ä¸€ç¯‡é‡Œæœ‰ä¸ªå‘è¿˜æ²¡å¡«ï¼Œå°±æ˜¯å¦‚ä½•åœ¨å·¥ä½œçº¿ç¨‹åˆ›å»ºä½¿ç”¨&lt;strong&gt;Handler&lt;/strong&gt;ï¼Œä¸è¿‡ç›¸ä¿¡çœ‹åˆ°è¿™é‡Œçš„åŒå­¦åº”è¯¥å·²ç»å¿ƒé‡Œæœ‰åº•äº†å§ï¼Œå‚è€ƒä¸Šä¸€ç¯‡ä¸­&lt;strong&gt;ActivityThread&lt;/strong&gt;ä¸­çš„&lt;strong&gt;main()&lt;/strong&gt;æ–¹æ³•ï¼Œå¾ˆå®¹æ˜“åˆ›å»ºè‡ªå·±çš„æ— çº¿å¾ªç¯å·¥ä½œçº¿ç¨‹äº†ï¼Œä¸‹é¢ç›´æ¥ç»™å‡ºä»£ç ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;	new Thread(){
            Handler handler;
            @Override
            public void run() {
                super.run();
                Looper.prepare();
                 handler = new Handler(){
                    @Override
                    public void handleMessage(Message msg) {
                        super.handleMessage(msg);
                        //handler the message
                    }
                };
                Looper.loop();
            }
        };
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;ä»¥ä¸Šï¼Œå³åœ¨å·¥ä½œçº¿ç¨‹ä¸­åˆ›å»ºäº†&lt;strong&gt;handler&lt;/strong&gt;,ç„¶åå°†&lt;strong&gt;handler&lt;/strong&gt;çš„å¼•ç”¨ä¸¢ç»™åˆ«çš„çº¿ç¨‹ï¼Œåˆ«çš„çº¿ç¨‹å°±å¯ä»¥é€šè¿‡&lt;strong&gt;handler&lt;/strong&gt;å‘æ¶ˆæ¯åˆ°è¿™ä¸ªå·¥ä½œçº¿ç¨‹æ¥å¤„ç†ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Handler&lt;/strong&gt;å¯¹äºæ¶ˆæ¯çš„åˆ†å‘å’Œå¤„ç†çš„é€»è¾‘æ€»ç®—è¯´å®Œäº†ï¼Œæ¥ä¸‹å»çœ‹çœ‹&lt;strong&gt;Message&lt;/strong&gt;æ˜¯å¦‚ä½•è¢«é€åˆ°&lt;strong&gt;Handler&lt;/strong&gt;çš„ã€‚
å…ˆçœ‹ä¸‹&lt;strong&gt;Message&lt;/strong&gt;çš„åŸºæœ¬ä¿¡æ¯å§ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;int what:&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;è¡¨æ˜æ¶ˆæ¯çš„ç±»åˆ«ï¼Œ&lt;strong&gt;handler&lt;/strong&gt;æ ¹æ®è¿™ä¸ªå­—æ®µæ¥åˆ¤æ–­å¦‚ä½•å¤„ç†è¿™ä¸ª&lt;strong&gt;Message&lt;/strong&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Bundle dataï¼š&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;ç”¨äºå­˜æ”¾æ•°æ®ï¼Œå¯ä»¥å­˜æ”¾ä¸€äº›ç›¸å¯¹å¤æ‚çš„å†…å®¹ï¼Œå› æ­¤å¼€é”€ç¨å¾®å¤§ä¸€ç‚¹&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;int arg1,arg2:&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;ä¸¤ä¸ªåŸºæœ¬ç±»å‹çš„å‚æ•°ï¼Œç”¨äºä¼ é€’ä¸€äº›ç®€å•çš„&lt;strong&gt;Message&lt;/strong&gt;ä¿¡æ¯ï¼Œå¯ä»¥çš„è¯å°½é‡ç”¨è¿™ä¸¤ä¸ªå‚æ•°æ¥ä¼ é€’ä¿¡æ¯ï¼Œç›¸å¯¹äº&lt;strong&gt;Bundle data&lt;/strong&gt;å®ƒæ€§èƒ½æ¶ˆè€—ä¼šå°å¾ˆå¤š&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;int flags:&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;å½“å‰&lt;strong&gt;Message&lt;/strong&gt;çŠ¶æ€çš„ä¸€ä¸ªæ ‡å¿—ä½ï¼Œç±»ä¼¼å¼‚æ­¥ï¼Œä½¿ç”¨ä¸­è¿™äº›çŠ¶æ€&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;long whenï¼š&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;è¡¨ç¤ºè¿™ä¸ª&lt;strong&gt;Message&lt;/strong&gt;åº”è¯¥åœ¨ä½•æ—¶è¢«æ‰§è¡Œï¼Œ&lt;strong&gt;MessageQueue&lt;/strong&gt;ä¸­&lt;strong&gt;Message&lt;/strong&gt;å°±æ˜¯ä»¥è¿™ä¸ªå­—æ®µä¸ºæ¥æ’åºçš„&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Handler targetï¼š&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Message&lt;/strong&gt;å°†è¦è¢«å‘é€çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ç”±å“ªä¸ªtargetæ¥æ¥å—å¤„ç†è¿™ä¸ª&lt;strong&gt;Message&lt;/strong&gt;ï¼Œ&lt;strong&gt;è¿™ä¸ªå­—æ®µå¿…é¡»ä¸ä¸ºnull&lt;/strong&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Runnable callbackï¼š&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;è¿™ä¸ªè®²&lt;strong&gt;handler&lt;/strong&gt;çš„æ—¶å€™è¯´åˆ°è¿‡äº†ï¼Œå¦‚æœæœ‰è¿™ä¸ªå­—æ®µï¼Œé‚£ä¹ˆè¿™ä¸ª&lt;strong&gt;Message&lt;/strong&gt;å°†ç”±æ­¤&lt;strong&gt;callback&lt;/strong&gt;æ¥å¤„ç†ï¼Œæ³¨æ„ä¸‹ï¼Œå®ƒæ˜¯ä¸€ä¸ª&lt;strong&gt;Runnable&lt;/strong&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Message next:&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;ç”±äº&lt;strong&gt;Message&lt;/strong&gt;åœ¨æ¶ˆæ¯æ± ä¸­æ˜¯é“¾è¡¨çš„å½¢å¼ç»´æŠ¤çš„ï¼Œæ‰€ä»¥è¿™ä¸ªå­—æ®µè¡¨ç¤ºä¸‹ä¸€ä¸ª&lt;strong&gt;Message&lt;/strong&gt;å¯¹è±¡&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;static Message sPoolï¼š&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;è¿™ä¸ªæ˜¯é™æ€å˜é‡ï¼ŒæŒ‡å‘å½“å‰æ¶ˆæ¯æ± çš„ç¬¬ä¸€ä¸ªç©ºé—²&lt;strong&gt;Message&lt;/strong&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;static int sPoolSize:&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;æ¶ˆæ¯æ± çš„å¤§å°ï¼Œä¹Ÿå°±æ˜¯å‰©ä½™ç©ºé—²&lt;strong&gt;Message&lt;/strong&gt;çš„æ•°é‡&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;static final int MAX_POOL_SIZE = 50;&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;ä¸ç”¨è§£é‡Šäº†å§ï¼Ÿ&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å†è´´ä¸€ä¸‹ä¾‹å­ä¸­çš„ç¬¬äºŒæ®µä»£ç ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;	new Thread(){
            @Override
            public void run() {
                super.run();
                Message message = Message.obtain();
                message.what = TEST;
                Bundle bundle =new Bundle();
                bundle.putString(&quot;test key&quot;,&quot;test value&quot;);
                message.setData(bundle);
       			handler.sendMessage(msg);                
            }
        }.start();
        
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Message&lt;/strong&gt;çš„è·å–æ–¹å¼ç‰¹åˆ«å¤šï¼Œé™¤äº†è‡ªå·±newä¸€ä¸ªå¤–ï¼Œå…¶ä»–åŸºæœ¬éƒ½å¤§åŒå°å¼‚ï¼Œæœ€ç»ˆéƒ½ä»&lt;strong&gt;Message&lt;/strong&gt;æ¶ˆæ¯æ± å–ä¸€ä¸ªç©ºé—²çš„&lt;strong&gt;Message&lt;/strong&gt;ä½¿ç”¨ï¼Œå› ä¸ºAndroidç³»ç»Ÿä¸­åˆ°å¤„éƒ½ç”¨åˆ°äº†&lt;strong&gt;Message&lt;/strong&gt;ï¼Œå› æ­¤ä¼šéœ€è¦å¤§é‡çš„&lt;strong&gt;Message&lt;/strong&gt;å¯¹è±¡ï¼Œä½¿ç”¨æ¶ˆæ¯æ± çš„æ–¹å¼å¯ä»¥å‡å°‘é¢‘ç¹çš„åˆ›å»ºé”€æ¯å¯¹è±¡ï¼Œå¤§å¤§çš„æé«˜æ€§èƒ½ã€‚æˆ‘è¿™é‡Œç›´æ¥ç”¨æœ€åŸºæœ¬çš„æ–¹å¼è·å–ï¼Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;Message.obtain();&lt;/code&gt;,çœ‹æºç å§ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;	/**
     * Return a new Message instance from the global pool. Allows us to
     * avoid allocating new objects in many cases.
     */
    public static Message obtain() {
        synchronized (sPoolSync) {
            if (sPool != null) {
                Message m = sPool;
                sPool = m.next;
                m.next = null;
                m.flags = 0; // clear in-use flag
                sPoolSize--;
                return m;
            }
        }
        return new Message();
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;å¯¹ç€ä¸Šé¢çš„å­—æ®µä»‹ç»ï¼Œå¾ˆå®¹æ˜“çœ‹å‡ºè¿™ä¸ªæ–¹æ³•çš„ä½œç”¨å°±æ˜¯å°†æ¶ˆæ¯æ± çš„ç¬¬ä¸€ä¸ªç©ºé—²&lt;strong&gt;Message&lt;/strong&gt;æ‹¿å‡ºæ¥ï¼Œç„¶åæ¶ˆæ¯æ± çš„æ•°é‡å‡1ï¼Œå½“ç„¶å¦‚æœæ¶ˆæ¯æ± å·²ç»æ²¡ç”¨ç©ºé—²&lt;strong&gt;Message&lt;/strong&gt;äº†ï¼Œé‚£å°±newä¸€ä¸ªè¿”å›äº†ã€‚&lt;/p&gt;

&lt;p&gt;ä¾‹å­ä¸­åªç”¨åˆ°äº†&lt;strong&gt;what&lt;/strong&gt;å’Œ&lt;strong&gt;data&lt;/strong&gt;å­—æ®µï¼Œç®€å•ç»™å®ƒä»¬èµ‹äº†å€¼ï¼Œç„¶åå°±è°ƒç”¨&lt;strong&gt;handler.sendMessage(msg); **å°†æ¶ˆæ¯å‘é€ç»™äº†æˆ‘ä»¬åœ¨ä¸»çº¿ç¨‹åˆ›å»ºçš„&lt;/strong&gt;handler**äº†ã€‚&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;	public final boolean sendMessage(Message msg)
    {
        return sendMessageDelayed(msg, 0);
    }
    
    public final boolean sendMessageDelayed(Message msg, long delayMillis)
    {
        if (delayMillis &amp;lt; 0) {
            delayMillis = 0;
        }
        return sendMessageAtTime(msg, SystemClock.uptimeMillis() + delayMillis);
    }
    
    /**
     * Enqueue a message into the message queue after all pending messages
     * before the absolute time (in milliseconds) &amp;lt;var&amp;gt;uptimeMillis&amp;lt;/var&amp;gt;.
     * &amp;lt;b&amp;gt;The time-base is {@link android.os.SystemClock#uptimeMillis}.&amp;lt;/b&amp;gt;
     * Time spent in deep sleep will add an additional delay to execution.
     * You will receive it in {@link #handleMessage}, in the thread attached
     * to this handler.
     * 
     * @param uptimeMillis The absolute time at which the message should be
     *         delivered, using the
     *         {@link android.os.SystemClock#uptimeMillis} time-base.
     *         
     * @return Returns true if the message was successfully placed in to the 
     *         message queue.  Returns false on failure, usually because the
     *         looper processing the message queue is exiting.  Note that a
     *         result of true does not mean the message will be processed -- if
     *         the looper is quit before the delivery time of the message
     *         occurs then the message will be dropped.
     */
    public boolean sendMessageAtTime(Message msg, long uptimeMillis) {
        MessageQueue queue = mQueue;
        if (queue == null) {
            RuntimeException e = new RuntimeException(
                    this + &quot; sendMessageAtTime() called with no mQueue&quot;);
            Log.w(&quot;Looper&quot;, e.getMessage(), e);
            return false;
        }
        return enqueueMessage(queue, msg, uptimeMillis);
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;å‰é¢ä¸¤ä¸ªæ–¹æ³•çš„æ³¨é‡Šæˆ‘æ²¡è´´ï¼Œå› ä¸ºè·Ÿç¬¬ä¸‰ä¸ªæ–¹æ³•å†…å®¹å·®ä¸å¤šï¼Œè€Œä¸”æœ€ç»ˆä¹Ÿéƒ½æ˜¯è°ƒç”¨ç¬¬ä¸‰ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥çœ‹äº†ç¬¬ä¸‰ä¸ªæ–¹æ³•çš„æ³¨é‡Šå’Œæ–¹æ³•ä½“åº”è¯¥å¾ˆå®¹æ˜“æ˜ç™½å‰ä¸¤ä¸ªæ–¹æ³•çš„ä½œç”¨ã€‚
ç¬¬ä¸€ä¸ªæ–¹æ³•æ˜¯ç›´æ¥å°†æ¶ˆæ¯å‘é€handlerå¤„ç†ï¼Œæ‰€ä»¥å®ƒä½¿ç”¨0æ¯«ç§’çš„å»¶æ—¶ä½œä¸ºå‚æ•°è°ƒç”¨ç¬¬äºŒä¸ªæ–¹æ³•ï¼Œç¬¬äºŒä¸ªæ–¹æ³•åˆ¤æ–­å¦‚æœå»¶æ—¶å°äº0åˆ™é»˜è®¤ç»™0ï¼Œå› ä¸ºå°äº0çš„å»¶è¿Ÿä¹Ÿå°±æ„å‘³ç€æ¯”å½“å‰æ—¶é—´æ—©ï¼Œå½“ç„¶ä¸å¯èƒ½å›åˆ°è¿‡å»å¤„ç†è¿™ä¸ªæ¶ˆæ¯äº†ï¼Œç„¶åå®ƒåˆå°†å½“å‰æ—¶é—´åŠ ä¸Šå»¶æ—¶ï¼Œè°ƒç”¨äº†ç¬¬ä¸‰ä¸ªæ–¹æ³•ï¼Œè¿™æ ·ç¬¬ä¸‰ä¸ªæ–¹æ³•æ‹¿åˆ°çš„æ—¶é—´å°±æ˜¯ä¸€ä¸ªç»å¯¹å€¼äº†ï¼Œç„¶åæˆ‘ä»¬çœ‹åˆ°äº†&lt;strong&gt;mQueue&lt;/strong&gt;ï¼Œè¿™ä¸ªåˆ›å»º&lt;strong&gt;handler&lt;/strong&gt;çš„æ—¶å€™æˆ‘ä»¬å°±çœ‹åˆ°äº†ï¼ŒæŒ‡å‘ä¸»çº¿ç¨‹å¯¹åº”çš„&lt;strong&gt;Looper&lt;/strong&gt;ä¸­çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæœ€åreturnäº†ä¸€ä¸ªæ–¹æ³•è°ƒç”¨ï¼Œçœ‹åå­—ç»ˆäºè¦åŠ å…¥æ¶ˆæ¯é˜Ÿåˆ—äº†ã€‚&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; 	private boolean enqueueMessage(MessageQueue queue, Message msg, long uptimeMillis) {
        msg.target = this;
        if (mAsynchronous) {
            msg.setAsynchronous(true);
        }
        return queue.enqueueMessage(msg, uptimeMillis);
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;ç­‰ç­‰ï¼ŒåŸæ¥æˆ‘ä»¬åˆšæ‰å‘é€çš„&lt;strong&gt;Message&lt;/strong&gt;è¿˜æ²¡å¯¹è±¡å‘¢ï¼Œé‚£å•¥ï¼Œæˆ‘ä¸æ˜¯è¯´é‚£ä¸ªå¯¹è±¡ï¼Œæ­£ç»ç‚¹å„¿ï¼æ‰€ä»¥åŠ å…¥æ¶ˆæ¯é˜Ÿåˆ—å‰å…ˆç»™å®ƒä¸€ä¸ªå¯¹è±¡å§ï¼ç„¶åå¦‚æœæˆ‘ä»¬çš„&lt;strong&gt;handler&lt;/strong&gt;æ˜¯å¼‚æ­¥çš„å°†&lt;strong&gt;msg&lt;/strong&gt;çš„&lt;strong&gt;flag&lt;/strong&gt;æ ‡å¿—ä½åŠ ä¸Šæˆå¼‚æ­¥,è¿™ä¸‹&lt;strong&gt;msg&lt;/strong&gt;å¼€å¼€å¿ƒå¿ƒåœ°é¢†ç€å¯¹è±¡å»æ’é˜Ÿäº†~&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;	//MessageQueue
	boolean enqueueMessage(Message msg, long when) {
        if (msg.target == null) {
            throw new IllegalArgumentException(&quot;Message must have a target.&quot;);
        }
        if (msg.isInUse()) {
            throw new IllegalStateException(msg + &quot; This message is already in use.&quot;);
        }

        synchronized (this) {
            if (mQuitting) {
                IllegalStateException e = new IllegalStateException(
                        msg.target + &quot; sending message to a Handler on a dead thread&quot;);
                Log.w(TAG, e.getMessage(), e);
                msg.recycle();
                return false;
            }

            msg.markInUse();
            msg.when = when;
            Message p = mMessages;
            boolean needWake;
            if (p == null || when == 0 || when &amp;lt; p.when) {
                // New head, wake up the event queue if blocked.
                msg.next = p;
                mMessages = msg;
                needWake = mBlocked;
            } else {
                // Inserted within the middle of the queue.  Usually we don&#39;t have to wake
                // up the event queue unless there is a barrier at the head of the queue
                // and the message is the earliest asynchronous message in the queue.
                needWake = mBlocked &amp;amp;&amp;amp; p.target == null &amp;amp;&amp;amp; msg.isAsynchronous();
                Message prev;
                for (;;) {
                    prev = p;
                    p = p.next;
                    if (p == null || when &amp;lt; p.when) {
                        break;
                    }
                    if (needWake &amp;amp;&amp;amp; p.isAsynchronous()) {
                        needWake = false;
                    }
                }
                msg.next = p; // invariant: p == prev.next
                prev.next = msg;
            }

            // We can assume mPtr != 0 because mQuitting is false.
            if (needWake) {
                nativeWake(mPtr);
            }
        }
        return true;
    }

&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;é¦–å…ˆåˆ¤æ–­&lt;strong&gt;Message&lt;/strong&gt;çš„å¯¹è±¡&lt;strong&gt;target&lt;/strong&gt;æ˜¯å¦ä¸ºç©º(æ‰€ä»¥è¯´&lt;strong&gt;Message&lt;/strong&gt;ä¸èƒ½æ²¡æœ‰å¯¹è±¡&lt;strong&gt;target&lt;/strong&gt;),ç„¶ååˆ¤æ–­&lt;strong&gt;Message&lt;/strong&gt;æ˜¯å¦æ­£åœ¨ä½¿ç”¨ä¸­,åœ¨ç»å†çš„å‰é¢çš„å…¥é˜Ÿæ­¥éª¤åï¼Œæˆ‘ä»¬è¿™ä¸ª&lt;strong&gt;Message&lt;/strong&gt;éƒ½æ»¡è¶³äº†æ¡ä»¶ï¼Œç„¶åè¿›å…¥ä¸€ä¸ªåŒæ­¥å—ï¼Œé¦–å…ˆåˆ¤æ–­æ˜¯å¦æ­£åœ¨é€€å‡ºä¸­ï¼Œå› ä¸ºä¸»çº¿ç¨‹æ˜¯ä¸å¯é€€å‡ºçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿä¸ç”¨è€ƒè™‘ï¼Œä¸è¿‡é‡Œé¢æ–¹æ³•ä¹Ÿæ˜¯ä¸€ç›®äº†ç„¶ï¼Œå›æ”¶&lt;strong&gt;Message&lt;/strong&gt;,è¿”å›&lt;strong&gt;false&lt;/strong&gt;é€šçŸ¥ä¸Šå±‚å…¥é˜Ÿå¤±è´¥ã€‚æˆ‘ä»¬ç»§ç»­çœ‹æ»¡è¶³æ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œå°†&lt;strong&gt;Message&lt;/strong&gt;æ ‡è®°ä¸ºåœ¨ä½¿ç”¨ä¸­(&lt;code class=&quot;highlighter-rouge&quot;&gt;msg.markInUse()&lt;/code&gt;),ç»™&lt;strong&gt;when&lt;/strong&gt;å­—æ®µèµ‹å€¼ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡æŒ‡å‘æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªæ¶ˆæ¯&lt;strong&gt;mMessage&lt;/strong&gt;ï¼Œå®šä¹‰äº†ä¸€ä¸ªå¸ƒå°”ç±»å‹çš„å­—æ®µ&lt;strong&gt;needWake&lt;/strong&gt;,è¡¨ç¤ºæ˜¯å¦éœ€è¦å”¤é†’å½“å‰çº¿ç¨‹ï¼Œå› ä¸ºæ²¡æœ‰æ¶ˆæ¯éœ€è¦å¤„ç†çš„æ—¶å€™æˆ‘ä»¬çš„Looperçº¿ç¨‹æ˜¯é˜»å¡çš„ã€‚å½“æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªæ¶ˆæ¯ä¸º&lt;strong&gt;null&lt;/strong&gt;æˆ–è€…æˆ‘ä»¬æœ¬æ¬¡éœ€è¦å…¥é˜Ÿçš„æ¶ˆæ¯å¯¹è±¡&lt;strong&gt;msg&lt;/strong&gt;çš„&lt;strong&gt;when&lt;/strong&gt;ä¸º0æˆ–è€…å°äºåŸæ¥çš„é˜Ÿé¦–æ¶ˆæ¯çš„&lt;strong&gt;when&lt;/strong&gt;å€¼ï¼Œåˆ™å°†&lt;strong&gt;msg&lt;/strong&gt;æ’å…¥åˆ°æ¶ˆæ¯é˜Ÿåˆ—çš„é˜Ÿé¦–ï¼Œä¹Ÿå°±æ˜¯&lt;strong&gt;mMessage&lt;/strong&gt;ä¹‹å‰ï¼Œç„¶å&lt;strong&gt;mMessage&lt;/strong&gt;é‡æ–°æŒ‡å‘æ–°çš„é˜Ÿé¦–ï¼Œä¹Ÿå°±æ˜¯&lt;strong&gt;msg&lt;/strong&gt;ï¼›å½“é‚£äº›æ¡ä»¶ä¸æ»¡è¶³çš„æ—¶å€™ï¼Œåˆ™éœ€è¦å°†&lt;strong&gt;msg&lt;/strong&gt;æ’å…¥åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­è€Œä¸æ˜¯é˜Ÿé¦–ï¼Œæ’å…¥çš„æ–¹å¼ä¹Ÿå¾ˆç®€å•é™¤æš´ï¼Œéå†åŸé˜Ÿåˆ—çš„æ¶ˆæ¯ï¼Œä¾æ¬¡æ¯”å¯¹&lt;strong&gt;when&lt;/strong&gt;çš„å€¼ï¼Œç›´åˆ°é˜Ÿå°¾æˆ–è€…æ‰¾åˆ°ä¸‹ä¸€ä¸ªæ¶ˆæ¯çš„&lt;strong&gt;when&lt;/strong&gt;å€¼æ¯”&lt;strong&gt;msg&lt;/strong&gt;çš„&lt;strong&gt;when&lt;/strong&gt;å€¼å¤§çš„æ—¶å€™è·³å‡ºå¾ªç¯ï¼Œå°†&lt;strong&gt;msg&lt;/strong&gt;æ’åˆ°å…¶ä¸­ï¼Œè¿™ä¸ªå…¥é˜Ÿçš„è¿‡ç¨‹ä¹Ÿå°±å®Œæˆäº†ï¼Œéƒ½æ˜¯ä¸€äº›é“¾è¡¨çš„åŸºæœ¬æ“ä½œã€‚ä¹‹å‰ä¹Ÿæœ‰è¯´åˆ°ï¼Œå› ä¸ºæ¯æ¬¡æœ‰æ¶ˆæ¯è¿›å…¥&lt;strong&gt;mQueue&lt;/strong&gt;ï¼Œæˆ‘ä»¬éƒ½æ˜¯ä»¥è¿™ç§æ–¹å¼æ¥æ’å…¥çš„ï¼Œæ‰€ä»¥æœ‰åºçš„æ¶ˆæ¯é˜Ÿåˆ—å°±æ˜¯ç®€å•ä»¥æ¶ˆæ¯çš„&lt;strong&gt;when&lt;/strong&gt;çš„å¤§å°æ¥æ’åºçš„ã€‚æ¶ˆæ¯æ’å…¥åˆ°æ¶ˆæ¯é˜Ÿåˆ—å®Œæˆåï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦å”¤é†’ä¸»çº¿ç¨‹ï¼Œéœ€è¦åˆ™è°ƒç”¨nativeæ–¹æ³•&lt;strong&gt;nativeWake()&lt;/strong&gt;å”¤é†’ä¸»çº¿ç¨‹æ¥å¤„ç†æ¶ˆæ¯ï¼ˆ&lt;code class=&quot;highlighter-rouge&quot;&gt; Message msg = queue.next();//Looper.loop()æ–¹æ³•ä¸­è¢«å”¤é†’åå–å‡ºæ¶ˆæ¯å¹¶åˆ†å‘å¤„ç†&lt;/code&gt;ï¼‰ã€‚æœ€åè¿”å›&lt;strong&gt;true&lt;/strong&gt;è¡¨æ˜æ¶ˆæ¯æ’å…¥é˜Ÿåˆ—æˆåŠŸã€‚è¿™æ ·&lt;strong&gt;Message&lt;/strong&gt;å…¥é˜Ÿçš„è¿‡ç¨‹å°±ç®—å®Œæˆäº†ï¼Œæ˜¯ä¸æ˜¯æŒºç®€å•çš„~&lt;/p&gt;

&lt;p&gt;ä»¥ä¸Šï¼Œå°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ¶ˆæ¯ä¼ é€’å’Œåˆ†å‘è¿‡ç¨‹ã€‚å®é™…ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬ç”¨åˆ°æ›´å¤šçš„å¯èƒ½æ˜¯&lt;code class=&quot;highlighter-rouge&quot;&gt;handler.post(runnable);&lt;/code&gt;,&lt;code class=&quot;highlighter-rouge&quot;&gt;handler.postDelayed(runnable,delayMillis);&lt;/code&gt;,&lt;code class=&quot;highlighter-rouge&quot;&gt;view.postDelayed(runnable,delayMillis);&lt;/code&gt;ä¹‹ç±»çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•çœ‹ä¸Šå»å¥½åƒæ²¡æœ‰&lt;strong&gt;Message&lt;/strong&gt;ä»€ä¹ˆäº‹ï¼Œä½†æ˜¯ç‚¹è¿›å»ä¸€çœ‹å°±å‘ç°ï¼Œè¿™ä¸ªè¢«postçš„&lt;strong&gt;runnable&lt;/strong&gt;å°±æ˜¯&lt;strong&gt;Message&lt;/strong&gt;çš„&lt;strong&gt;callback&lt;/strong&gt;ï¼Œç®€å•å°è£…ä¸€ä¸‹å°±åˆèµ°ä¸Šäº†åˆšåˆšè®²å®Œçš„æ¶ˆæ¯ä¼ é€’è·¯çº¿ï¼Œè¿˜æ²¡ååº”è¿‡æ¥çš„å›å¤´çœ‹çœ‹&lt;strong&gt;handler&lt;/strong&gt;çš„&lt;strong&gt;dispatchMessage(Message msg)&lt;/strong&gt;æ–¹æ³•ï¼Œå› æ­¤è¿™äº›æ–¹å¼æˆ‘ä»¬éƒ½ä¸ç”¨é‡å†™&lt;strong&gt;handleMessage(Message msg)&lt;/strong&gt;æ–¹æ³•,ä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ã€‚&lt;strong&gt;&lt;em&gt;å‹æƒ…æç¤ºï¼šéå¸¸æ–¹ä¾¿çš„åŒæ—¶ä¹Ÿéå¸¸å®¹æ˜“å¯¼è‡´å†…å­˜æ³„éœ²ã€ç©ºæŒ‡é’ˆå’Œå…¶ä»–ä¸€äº›çŠ¶æ€ç´Šä¹±çš„é”™è¯¯ï¼ˆåˆ«é—®æˆ‘æ€ä¹ˆçŸ¥é“çš„ï¼Œæ­»è¿‡å¤ªå¤šè„‘ç»†èƒğŸ˜­ï¼‰ï¼Œæ…ç”¨ï¼ï¼ï¼&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

</description>
        <pubDate>Mon, 06 Feb 2017 23:10:00 +0800</pubDate>
        <link>http://yourdomain.com/blog/2017/02/06/Android%E6%B6%88%E6%81%AF%E5%88%86%E5%8F%91%E5%8F%8A%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%88%87%E6%8D%A2%E4%B9%8BHandler-Message%E7%9A%84%E7%BB%86%E6%9E%9D%E6%9C%AB%E8%8A%82(%E4%BA%8C).html</link>
        <guid isPermaLink="true">http://yourdomain.com/blog/2017/02/06/Android%E6%B6%88%E6%81%AF%E5%88%86%E5%8F%91%E5%8F%8A%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%88%87%E6%8D%A2%E4%B9%8BHandler-Message%E7%9A%84%E7%BB%86%E6%9E%9D%E6%9C%AB%E8%8A%82(%E4%BA%8C).html</guid>
        
        
        <category>Blog</category>
        
      </item>
    
      <item>
        <title>Androidæ¶ˆæ¯åˆ†å‘åŠå¤šçº¿ç¨‹åˆ‡æ¢ä¹‹Handlerã€Messageçš„ç»†ææœ«èŠ‚ï¼ˆä¸€ï¼‰</title>
        <description>&lt;p&gt;ä»Šå¤©æ¥æ‰’ä¸€æ‰’Androidçš„æ¶ˆæ¯åˆ†å‘æœºåˆ¶å’Œå¤šçº¿ç¨‹åˆ‡æ¢è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸å¸¸çœ‹åˆ°ç”¨çš„Handlerï¼ŒMessageï¼ˆè¿˜æœ‰ä¸¤ä¸ªä¸å¤ªçœ‹å¾—åˆ°çš„MessageQueueå’ŒLooperï¼‰å®ƒä»¬çš„åŸç†ã€‚é¢ï¼Œå½“ç„¶æœ‰äººä¼šè¯´è¿˜æœ‰AsyncTaskè¿™ç©æ„å„¿ï¼Œæ€ä¹ˆè¯´å‘¢ï¼Œåæ­£æˆ‘æ˜¯åŸºæœ¬æ²¡ç”¨è¿‡AsyncTaskï¼Œä¹Ÿæ²¡è§è°å–œæ¬¢ç”¨è¿™ä¸ªï¼Œæ€»æ„Ÿè§‰ä½¿ç”¨èµ·æ¥æ²¡Handler+Messageæ–¹ä¾¿ï¼Œç„¶è€Œæˆ‘ç”¨çš„æ›´å¤šçš„æ˜¯Handler+Runnableï¼Œå½“ç„¶å®é™…ä¸ŠRunnableè¿˜æ˜¯è¢«åŒ…è£…æˆäº†Messageã€‚&lt;/p&gt;

&lt;p&gt;å…ˆç®€å•ä»‹ç»ä¸€ä¸‹è¿™å‡ ä¸ªç±»å§ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Handler:&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

 	å¤„ç†è€…ï¼Œä¸€èˆ¬åœ¨ä¸»çº¿ç¨‹åˆ›å»ºï¼ˆåœ¨å·¥ä½œçº¿ç¨‹ä¹Ÿå¯ä»¥åˆ›å»ºï¼Œè¿™ä¸ªä¸‹ä¸€ç¯‡ä¼šè¯¦ç»†è¯´åˆ°ï¼‰ï¼Œå¤„ç†å„ç§çº¿ç¨‹å‘é€è¿‡æ¥çš„* Messageï¼Œæ ¹æ®Messageå†…å®¹åœ¨ä¸»çº¿ç¨‹åšä¸åŒçš„å¤„ç†ã€‚
&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Message:&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;æ¶ˆæ¯ä½“ï¼Œåœ¨å¤šçº¿ç¨‹ä¸­æ‹…ä»»ä¸€ä¸ªå†…å®¹è½½ä½“çš„è§’è‰²ï¼ŒåŒ…å«äº†æ¶ˆæ¯çš„ç±»å‹ï¼Œå‚æ•°ï¼Œæ•°æ®ç­‰å†…å®¹ï¼Œå…¶ä¸­è¿˜åŒ…æ‹¬ä¸€ä¸ªé‡è¦çš„å¯¹è±¡ï¼Œé‚£å°±æ˜¯å®ƒå°†ä¼šè¢«å‘é€ç»™é‚£ä¸ªhandlerã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;MessageQueueï¼š&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ‰€æœ‰å‘é€ç»™handlerå¤„ç†çš„æ¶ˆæ¯éƒ½ä¼šä¿å­˜åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå…¶å†…éƒ¨ä½¿ç”¨é“¾è¡¨çš„å½¢å¼ç»´æŠ¤è¿™äº›messageã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Looperï¼š&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;è¿™ä¸ªæ€ä¹ˆè¯´å‘¢ï¼Œå®ƒçš„è‹±æ–‡è§£é‡Šä¸ºä¸€ä¸ªæ‰“ç¯çš„è£…ç½®ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“è¯¥æ€ä¹ˆç¿»è¯‘ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¯ä»¥è®©çº¿ç¨‹ä¸€ç›´æ´»ç€ï¼Œè€Œä¸æ˜¯æ‰§è¡Œå®Œä¸€ä¸ªåŠŸèƒ½ä»£ç åå°±æ­»æ‰äº†ï¼Œæ¯ä¸ªLooperçš„å®ä¾‹æœ‰ä¸€ä¸ªMessageQueueå’Œå½“å‰çº¿ç¨‹å¯¹è±¡ï¼Œæ­£æ˜¯è¿™ä¸¤ä¸ªç±»è®©çº¿ç¨‹å¯ä»¥ä¸€ç›´æ´»ç€ï¼Œä¹Ÿå°±æ˜¯Looperæ‰“ç¯çš„è£…ç½®çš„æ„æ€å§ã€‚æˆ‘ä»¬çš„ä¸»çº¿ç¨‹å°±æ˜¯å› ä¸ºå®ƒæ‰å¯ä»¥ä¸€ç›´æ‰§è¡Œè€Œä¸é€€å‡ºã€‚&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸Šé¢è¯´åˆ°Looperä½¿æˆ‘ä»¬çš„ä¸»çº¿ç¨‹å¯ä»¥ä¸€ç›´è¿è¡Œï¼Œç©¶ç«Ÿæ˜¯å’‹å›äº‹ï¼Œä¸Šä»£ç ï¼ï¼ï¼&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; public static void main(String[] args) {
        Â·Â·Â·Â·Â·Â·
        Looper.prepareMainLooper();

        ActivityThread thread = new ActivityThread();
        thread.attach(false);

        if (sMainThreadHandler == null) {
            sMainThreadHandler = thread.getHandler();
        }
		Â·Â·Â·Â·Â·Â·
        Looper.loop();

        throw new RuntimeException(&quot;Main thread loop unexpectedly exited&quot;);
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;æ²¡é”™ï¼Œå°±æ˜¯æˆ‘ä»¬çš„ä¸»çº¿ç¨‹åˆå§‹åŒ–çš„åœ°æ–¹ï¼Œä¹Ÿå°±æ˜¯åº”ç”¨ç¨‹åºå¯åŠ¨çš„å…¥å£ã€‚æˆ‘ä»¬çš„åº”ç”¨å¯¹äºAndroidç³»ç»Ÿè€Œè¨€ï¼Œè¯´ç™½äº†ä¹Ÿå°±æ˜¯ä¸€æ®µç¨‹åºä»£ç ï¼Œé‚£ä¹ˆç¨‹åºå¯åŠ¨çš„æ—¶å€™å½“ç„¶å¾—ä»å¯åŠ¨æ–¹æ³•å¼€å§‹äº†ï¼Œå®ƒå°±æ˜¯&lt;strong&gt;ActivityThread&lt;/strong&gt;ä¸­å¤§åé¼é¼çš„&lt;strong&gt;main()&lt;/strong&gt;æ–¹æ³•ï¼Œæ˜¯ä¸æ˜¯æƒ³èµ·æ¥javaä¸­çš„&lt;strong&gt;main()&lt;/strong&gt;æ–¹æ³•ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™é‡Œåˆ°åº•åšäº†å“ªäº›äº‹ã€‚é¦–å…ˆå°±æ˜¯è°ƒç”¨äº†&lt;strong&gt;Looper&lt;/strong&gt;çš„é™æ€æ–¹æ³•&lt;strong&gt;preoareMainLooper()&lt;/strong&gt;:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;	/**
     * Initialize the current thread as a looper, marking it as an
     * application&#39;s main looper. The main looper for your application
     * is created by the Android environment, so you should never need
     * to call this function yourself.  See also: {@link #prepare()}
     */
    public static void prepareMainLooper() {
        prepare(false);
        synchronized (Looper.class) {
            if (sMainLooper != null) {
                throw new IllegalStateException(&quot;The main Looper has already been prepared.&quot;);
            }
            sMainLooper = myLooper();
        }
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;è¿™ä¸ªæ˜¯æºç åŸå°ä¸åŠ¨çš„è´´ä¸Šæ¥çš„ï¼ŒåŒ…æ‹¬æ³¨é‡Šï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–¹æ³•åº”è¯¥ç”±ç³»ç»Ÿè°ƒç”¨ï¼Œå®ƒæ ¹æ®å½“å‰çº¿ç¨‹åˆå§‹åŒ–ä¸€ä¸ª&lt;strong&gt;Looper&lt;/strong&gt;å¯¹è±¡ï¼Œå¹¶ä¸”æ˜¯åº”ç”¨çš„â€main looperâ€ï¼Œä¹Ÿå°±æ˜¯æ–¹æ³•åæ‰€è¡¨ç°çš„ï¼Œæ¥ç€çœ‹æ–¹æ³•é‡Œçš„ç¬¬ä¸€è¡Œè°ƒç”¨ã€‚&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;	private static void prepare(boolean quitAllowed) {
        if (sThreadLocal.get() != null) {
            throw new RuntimeException(&quot;Only one Looper may be created per thread&quot;);
        }
        sThreadLocal.set(new Looper(quitAllowed));
    }
    
    private Looper(boolean quitAllowed) {
        mQueue = new MessageQueue(quitAllowed);
        mThread = Thread.currentThread();
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;è¿™é‡Œæœ‰ä¸ª&lt;strong&gt;sThreadLocal&lt;/strong&gt;ï¼Œå®ƒæ˜¯ä¸€ä¸ªé™æ€å±æ€§ï¼š**static final ThreadLocal&lt;Looper&gt; sThreadLocal = new ThreadLocal&lt;Looper&gt;();**ï¼Œä¹Ÿå°±æ˜¯å…¨å±€å°±ä¸€ä¸ªï¼Œæ¯ä¸ªçº¿ç¨‹æœ€å¤šå¯¹åº”ä¸€ä¸ª**Looper**å¯¹è±¡ï¼Œå¦‚æœæœ‰ï¼Œ**Looper**å¯¹è±¡éƒ½ä¼šä¿å­˜åœ¨**sThreadLocal**ä¸­ï¼Œæˆ‘ä»¬ç®€å•çš„æŠŠå®ƒç†è§£ä¸ºä¸€ä¸ªMapå°±è¡Œï¼Œkeyä¸ºå½“å‰çš„çº¿ç¨‹ï¼Œvalueä¸ºä¸€ä¸ª**Looper**å®ä¾‹ï¼Œå› ä¸ºçº¿ç¨‹ï¼ˆä¹Ÿå°±æ˜¯keyï¼‰åœ¨æ–¹æ³•è°ƒç”¨çš„æ—¶å€™å†…éƒ¨å¯ä»¥å–åˆ°ï¼Œæ‰€ä»¥å¯¹å®ƒè¿›è¡Œgetï¼Œsetæ“ä½œçš„æ—¶å€™ä¸éœ€è¦ä¼ keyï¼Œç›´æ¥ä¼ valueå°±è¡Œï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•å°±å¾ˆå¥½ç†è§£äº†ï¼Œå¦‚æœä¹‹å‰è°ƒç”¨è¿‡è¿™ä¸ªæ–¹æ³•ï¼Œ**sThreadLocal.get()**åˆ™ä¸ä¸ºnull,ç›´æ¥æŠ›å¼‚å¸¸ï¼ˆä¹Ÿå°±è¯´æ˜äº†ä¸€ä¸ªçº¿ç¨‹æœ€å¤šåªèƒ½å¯¹åº”ä¸€ä¸ª**Looper**å¯¹è±¡ï¼‰ï¼Œå¦åˆ™newä¸€ä¸ª**Looper**å¯¹è±¡å­˜åˆ°**sThreadLocal**ä¸­ï¼Œ**Looper**å¯¹è±¡åˆå§‹åŒ–çš„åŒæ—¶ä¹Ÿåˆå§‹åŒ–äº†ä¸€ä¸ª**MessageQueue**ï¼Œå¹¶ä¸”æŒæœ‰äº†å½“å‰çº¿ç¨‹çš„å¼•ç”¨ã€‚&lt;/Looper&gt;&lt;/Looper&gt;&lt;/p&gt;

&lt;p&gt;å¥½ï¼Œç»§ç»­çœ‹&lt;strong&gt;prepareMainLooper&lt;/strong&gt;æ–¹æ³•ï¼Œåˆ¤æ–­&lt;strong&gt;sMainLooper&lt;/strong&gt;æ˜¯å¦ä¸ºnullï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨å½“ç„¶ä¸ºnullï¼Œæ‰€ä»¥&lt;strong&gt;sMainLooper = myLooper();&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;	/**
     * Return the Looper object associated with the current thread.  Returns
     * null if the calling thread is not associated with a Looper.
     */
    public static @Nullable Looper myLooper() {
        return sThreadLocal.get();
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;å¾ˆç®€å•ï¼Œç›´æ¥è°ƒç”¨&lt;strong&gt;sThreadLocal.get()&lt;/strong&gt;æ–¹æ³•ï¼Œå¾ˆçœ¼ç†Ÿæ˜¯å§ï¼Œæˆ‘ä»¬åˆšåˆšè°ƒç”¨è¿‡å®ƒçš„&lt;strong&gt;set()&lt;/strong&gt;æ–¹æ³•ï¼Œè¿™ä¸ªæ—¶å€™è¿˜åœ¨åˆšæ‰çš„çº¿ç¨‹ä¸­å‘¢ï¼Œæ‰€ä»¥è¿™é‡Œå–å‡ºæ¥çš„å°±æ˜¯æˆ‘ä»¬åˆšåˆšæ”¾è¿›å»çš„&lt;strong&gt;new Looper()&lt;/strong&gt;ï¼Œå¯ä»¥ç¨å¾®çœ‹ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ä¸­æœ‰ä¸ªå‚æ•°å°±&lt;strong&gt;quitAllowed&lt;/strong&gt;ï¼Œæœ€ç»ˆè¢«ä¼ åˆ°äº†&lt;strong&gt;MessageQueue&lt;/strong&gt;çš„æ„é€ å™¨ä¸­ï¼Œåº”è¯¥å¯ä»¥çŒœåˆ°å®ƒè¡¨ç¤ºè¿™ä¸ª&lt;strong&gt;MessageQueue&lt;/strong&gt;æ˜¯å¦å¯ä»¥è¢«é€€å‡ºæˆ–è€…è¯´è¿™ä¸ªçº¿ç¨‹æ˜¯å¦èƒ½è¢«ç»“æŸæ‰ï¼Œå½“ç„¶å› ä¸ºæˆ‘ä»¬çš„çº¿ç¨‹æ˜¯ä¸»çº¿ç¨‹ï¼Œæ‰€ä»¥ä¼ &lt;strong&gt;false&lt;/strong&gt;ã€‚ç›®å‰ä¸ºæ­¢æˆ‘ä»¬å·²ç»å®Œæˆäº†&lt;strong&gt;prepareMainLooper()&lt;/strong&gt;æ–¹æ³•ï¼Œå®ƒæ‰€åšçš„äº‹å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯å°†æˆ‘ä»¬çš„çº¿ç¨‹ä½œä¸ºkeyåœ¨&lt;strong&gt;sThreadLocal&lt;/strong&gt;ä¸­ä¿å­˜äº†ä¸€ä¸ªä¸å¯é€€å‡ºçš„&lt;strong&gt;Looper&lt;/strong&gt;å¯¹è±¡ï¼ŒåŒæ—¶èµ‹å€¼ç»™&lt;strong&gt;sMainLooper&lt;/strong&gt;ï¼Œä¸ºä»€ä¹ˆè¿˜è¦å•ç‹¬å®šä¹‰ä¸€ä¸ª&lt;strong&gt;sMainLooper&lt;/strong&gt;å‘¢ï¼Ÿé¦–å…ˆ&lt;strong&gt;sMainLooper&lt;/strong&gt;æ˜¯ä¸€ä¸ªé™æ€å±æ€§ï¼Œä¸”æœ‰ä¸€ä¸ª&lt;strong&gt;getMainLooper()&lt;/strong&gt;é™æ€æ–¹æ³•ç›´æ¥è¿”å›&lt;strong&gt;sMainLooper&lt;/strong&gt;,æ‰€ä»¥æˆ‘çŒœæµ‹æ˜¯å› ä¸ºä¸»çº¿ç¨‹çš„&lt;strong&gt;Looper&lt;/strong&gt;å¯¹è±¡è·å–æ¯”è¾ƒé¢‘ç¹ï¼Œæ‰€ä»¥å•ç‹¬ä½œä¸ºä¸€ä¸ªå±æ€§ç›´æ¥è¯»å–ï¼Œçœçš„æ¯æ¬¡ä»&lt;strong&gt;sThreadLocal&lt;/strong&gt;ä¸­å»å–ï¼Œä»¥æ­¤å‡å°å¼€é”€ã€‚&lt;/p&gt;

&lt;p&gt;ä¸‹é¢æ”¾ä¸€å¼ å›¾ä½œä¸ºprepareMainLooperçš„æ€»ç»“å§ï¼Œå¯¹ç€å›¾çœ‹åº”è¯¥æ¸…æ™°å¾ˆå¤šï¼š
&lt;img src=&quot;prepareMainLooper.001.jpeg&quot; alt=&quot;image&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å›å¤´ç»§ç»­çœ‹&lt;strong&gt;main()&lt;/strong&gt;æ–¹æ³•ï¼Œæ¥ä¸‹å»newäº†ä¸€ä¸ªActivityThreadå®ä¾‹&lt;strong&gt;thread&lt;/strong&gt;ï¼Œå¹¶ä¸”è°ƒç”¨äº†&lt;strong&gt;attach()&lt;/strong&gt;æ–¹æ³•ï¼Œç„¶åå°†&lt;strong&gt;thread.getHandler()&lt;/strong&gt;è¿”å›ç»™&lt;strong&gt;sMainThreadHandler&lt;/strong&gt;ï¼Œè¿™å‡ è¡Œä»£ç ä¸»è¦æ˜¯åˆå§‹åŒ–äº†æˆ‘ä»¬çš„åº”ç”¨è¿›ç¨‹å’ŒAndroidç³»ç»Ÿçš„é€šä¿¡åŸºç¡€ï¼Œä¹Ÿå°±æ˜¯Binderç»„ä»¶ï¼Œä½¿å¾—æˆ‘ä»¬çš„åº”ç”¨è¿›ç¨‹å’ŒAndroidç³»ç»Ÿèƒ½å¤Ÿé€šä¿¡ï¼Œè¿™é‡Œæˆ‘ä»¬åªè¦çŸ¥é“ä¸ªå¤§æ¦‚ï¼Œå°±æ˜¯Androidç³»ç»Ÿä¼šå‘é€æ¶ˆæ¯ç»™æˆ‘ä»¬çš„åº”ç”¨çš„&lt;strong&gt;ActivityThread&lt;/strong&gt;(å¥½å§ï¼Œå…¶å®æ˜¯å®ƒçš„ä¸€ä¸ªå†…éƒ¨ç±»&lt;strong&gt;ApplicationThread&lt;/strong&gt;)ï¼Œç„¶åç”±&lt;strong&gt;ActivityThread&lt;/strong&gt;åŒ…è£…æˆ&lt;strong&gt;Message&lt;/strong&gt;æ”¾å…¥&lt;strong&gt;sMainLooper&lt;/strong&gt;çš„&lt;strong&gt;MessageQueue&lt;/strong&gt;ä¸­ç­‰å¾…æ‰§è¡Œã€‚å¦‚ä½•æ‰§è¡Œï¼Œè¯·å¾€ä¸‹çœ‹â€¦â€¦&lt;/p&gt;

&lt;p&gt;å†æ¥ä¸‹å»æ˜¯&lt;strong&gt;Looper.loop()&lt;/strong&gt;æ–¹æ³•&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;	/**
     * Run the message queue in this thread. Be sure to call
     * {@link #quit()} to end the loop.
     */
    public static void loop() {
        final Looper me = myLooper();
        if (me == null) {
            throw new RuntimeException(&quot;No Looper; Looper.prepare() wasn&#39;t called on this thread.&quot;);
        }
        final MessageQueue queue = me.mQueue;
		Â·Â·Â·Â·Â·Â·
        for (;;) {
            Message msg = queue.next(); // might block
            if (msg == null) {
                // No message indicates that the message queue is quitting.
                return;
            }

          	Â·Â·Â·Â·Â·Â·

            msg.target.dispatchMessage(msg);

            Â·Â·Â·Â·Â·Â·

            msg.recycleUnchecked();
        }
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ä»¥ä¸Šä»£ç é€»è¾‘ä¹Ÿååˆ†ç®€å•ï¼Œè·å–å½“å‰çº¿ç¨‹çš„&lt;strong&gt;Looper&lt;/strong&gt;å¯¹è±¡ï¼Œè¿›è€Œè·å–&lt;strong&gt;Looper&lt;/strong&gt;å¯¹è±¡ä¸­çš„&lt;strong&gt;MessageQueue&lt;/strong&gt;ä¿å­˜ä¸º&lt;strong&gt;queue&lt;/strong&gt;ï¼Œç„¶åè¿›å…¥æ­»å¾ªç¯ï¼Œæ¯æ¬¡éƒ½ä»&lt;strong&gt;queue&lt;/strong&gt;ä¸­å–ä¸‹ä¸€ä¸ª&lt;strong&gt;Message&lt;/strong&gt;ï¼Œå¾—åˆ°&lt;strong&gt;Message&lt;/strong&gt;åç›´æ¥è°ƒç”¨&lt;strong&gt;Message&lt;/strong&gt;å¯¹è±¡ä¸­ä¿å­˜çš„ç›®æ ‡&lt;strong&gt;handler&lt;/strong&gt;çš„&lt;strong&gt;dispatchMessageï¼ˆï¼‰&lt;/strong&gt;æ–¹æ³•ï¼Œç„¶åå›æ”¶&lt;strong&gt;Message&lt;/strong&gt;è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯ã€‚è‡³æ­¤ï¼Œæˆ‘ä»¬çš„ä¸»çº¿ç¨‹æ‰æˆä¸ºäº†çœŸæ­£æ„ä¹‰ä¸Šçš„ä¸»çº¿ç¨‹ã€‚ä¸Šé¢è¯´åˆ°Androidç³»ç»Ÿä¼šç»™æˆ‘ä»¬åº”ç”¨å‘æ¶ˆæ¯ï¼Œç„¶åæ¶ˆæ¯è¢«åŒ…è£…æˆ&lt;strong&gt;Message&lt;/strong&gt;ä¿å­˜åœ¨&lt;strong&gt;MessageQueue&lt;/strong&gt;ä¸­ï¼Œè€Œåœ¨&lt;strong&gt;loop()&lt;/strong&gt;æ–¹æ³•ä¸­æˆ‘ä»¬åˆå»å–ä¸‹ä¸€ä¸ª&lt;strong&gt;Message&lt;/strong&gt;ï¼Œæ˜¯ä¸æ˜¯å‘ç°äº†ä»€ä¹ˆï¼Ÿä¸é”™ï¼Œæˆ‘ä»¬åº”ç”¨ä¸­çš„å„ç§ç³»ç»Ÿæ–¹æ³•çš„è°ƒç”¨å…¶å®éƒ½æ˜¯éƒ½å°†Androidç³»ç»Ÿå‘é€çš„æ¶ˆæ¯åŒ…è£…æˆ&lt;strong&gt;Message&lt;/strong&gt;ä¿å­˜åˆ°æˆ‘ä»¬çš„åº”ç”¨ä¸»çº¿ç¨‹ç»‘å®šçš„&lt;strong&gt;sMainLooper&lt;/strong&gt;ä¸­çš„&lt;strong&gt;MessageQueue&lt;/strong&gt;ä¸­ï¼Œç„¶åç”±è¿™ä¸ªæ­»å¾ªç¯ä»&lt;strong&gt;MessageQueue&lt;/strong&gt;ä¸­å–ä¾æ¬¡å‡º&lt;strong&gt;Message&lt;/strong&gt;æ¶ˆæ¯è¿›è€Œæ‰§è¡Œå¯¹åº”çš„æ–¹æ³•ï¼Œè¿™æ ·ä¸€ä¸ªå®Œæ•´çš„æ¶ˆæ¯ä¼ é€’è¿‡ç¨‹å°±æ‰“é€šäº†ï¼&lt;/p&gt;

&lt;p&gt;è€æ ·å­ï¼Œçœ‹å›¾ï¼š
&lt;img src=&quot;loop.001.jpeg&quot; alt=&quot;image&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘ä¸ªäººè®¤ä¸ºä»¥ä¸Šå†…å®¹å·²ç»æ˜¯&lt;strong&gt;Handler&lt;/strong&gt;å’Œ&lt;strong&gt;Message&lt;/strong&gt;å®Œæˆå¤šçº¿ç¨‹åˆ‡æ¢å’Œæ¶ˆæ¯ä¼ é€’çš„æ ¸å¿ƒå†…å®¹äº†ï¼Œä¸»è¦ä¹Ÿå°±æ˜¯&lt;strong&gt;Looper&lt;/strong&gt;ç±»çš„ç”¨å¤„å’Œç”¨æ³•ï¼Œçœ‹æ‡‚äº†è¿™äº›å†…å®¹å†çœ‹æ•´ä¸ªæµç¨‹ä¼šå¾ˆè½»æ¾ï¼Œæ‰€ä»¥å¦‚æœè¿˜æ²¡ç†è§£çš„è¯å»ºè®®å†çœ‹å‡ éï¼Œæˆ–è€…ç›´æ¥å»çœ‹çœ‹Looperçš„æºç æ›´å¥½ã€‚&lt;/p&gt;

&lt;p&gt;å…¶å®è¿˜ä¸€ä¸ªæ¯”è¾ƒå…³é”®çš„æ­¥éª¤ï¼šå¦‚ä½•ä»&lt;strong&gt;MessageQueue&lt;/strong&gt;å–&lt;strong&gt;Message&lt;/strong&gt;ï¼Œä¸è¿‡ä¸ªäººæ„Ÿè§‰å°±ç®—è¿™ä¸ªè¿‡ç¨‹å¯¹äºç†è§£æ•´ä¸ªæ¶ˆæ¯ä¼ é€’æœºåˆ¶å½±å“ä¸å¤§ï¼Œåªè¦çŸ¥é“&lt;strong&gt;MessageQueue&lt;/strong&gt;ä»¥é“¾è¡¨çš„å½¢å¼ç»´æŠ¤è¿™æ¯ä¸ªè¿›å…¥é˜Ÿåˆ—çš„&lt;strong&gt;Message&lt;/strong&gt;å°±è¡Œäº†ã€‚æœ‰å…´è¶£çš„å°ä¼™ä¼´ä¹Ÿå¯ä»¥çœ‹çœ‹æºç ï¼Œæˆ‘å°±åœ¨è¿™é‡Œè´´ä¸€ä¸‹&lt;strong&gt;MessageQueue.next()&lt;/strong&gt;æ–¹æ³•çš„æºç å§ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;	Message next() {
        // Return here if the message loop has already quit and been disposed.
        // This can happen if the application tries to restart a looper after quit
        // which is not supported.
        final long ptr = mPtr;
        if (ptr == 0) {
            return null;
        }

        int pendingIdleHandlerCount = -1; // -1 only during first iteration
        int nextPollTimeoutMillis = 0;
        for (;;) {
            if (nextPollTimeoutMillis != 0) {
                Binder.flushPendingCommands();
            }

            nativePollOnce(ptr, nextPollTimeoutMillis);

            synchronized (this) {
                // Try to retrieve the next message.  Return if found.
                final long now = SystemClock.uptimeMillis();
                Message prevMsg = null;
                Message msg = mMessages;
                if (msg != null &amp;amp;&amp;amp; msg.target == null) {
                    // Stalled by a barrier.  Find the next asynchronous message in the queue.
                    do {
                        prevMsg = msg;
                        msg = msg.next;
                    } while (msg != null &amp;amp;&amp;amp; !msg.isAsynchronous());
                }
                if (msg != null) {
                    if (now &amp;lt; msg.when) {
                        // Next message is not ready.  Set a timeout to wake up when it is ready.
                        nextPollTimeoutMillis = (int) Math.min(msg.when - now, Integer.MAX_VALUE);
                    } else {
                        // Got a message.
                        mBlocked = false;
                        if (prevMsg != null) {
                            prevMsg.next = msg.next;
                        } else {
                            mMessages = msg.next;
                        }
                        msg.next = null;
                        if (DEBUG) Log.v(TAG, &quot;Returning message: &quot; + msg);
                        msg.markInUse();
                        return msg;
                    }
                } else {
                    // No more messages.
                    nextPollTimeoutMillis = -1;
                }

                // Process the quit message now that all pending messages have been handled.
                if (mQuitting) {
                    dispose();
                    return null;
                }

                // If first time idle, then get the number of idlers to run.
                // Idle handles only run if the queue is empty or if the first message
                // in the queue (possibly a barrier) is due to be handled in the future.
                if (pendingIdleHandlerCount &amp;lt; 0
                        &amp;amp;&amp;amp; (mMessages == null || now &amp;lt; mMessages.when)) {
                    pendingIdleHandlerCount = mIdleHandlers.size();
                }
                if (pendingIdleHandlerCount &amp;lt;= 0) {
                    // No idle handlers to run.  Loop and wait some more.
                    mBlocked = true;
                    continue;
                }

                if (mPendingIdleHandlers == null) {
                    mPendingIdleHandlers = new IdleHandler[Math.max(pendingIdleHandlerCount, 4)];
                }
                mPendingIdleHandlers = mIdleHandlers.toArray(mPendingIdleHandlers);
            }

            // Run the idle handlers.
            // We only ever reach this code block during the first iteration.
            for (int i = 0; i &amp;lt; pendingIdleHandlerCount; i++) {
                final IdleHandler idler = mPendingIdleHandlers[i];
                mPendingIdleHandlers[i] = null; // release the reference to the handler

                boolean keep = false;
                try {
                    keep = idler.queueIdle();
                } catch (Throwable t) {
                    Log.wtf(TAG, &quot;IdleHandler threw exception&quot;, t);
                }

                if (!keep) {
                    synchronized (this) {
                        mIdleHandlers.remove(idler);
                    }
                }
            }

            // Reset the idle handler count to 0 so we do not run them again.
            pendingIdleHandlerCount = 0;

            // While calling an idle handler, a new message could have been delivered
            // so go back and look again for a pending message without waiting.
            nextPollTimeoutMillis = 0;
        }
    }

&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;æœ¬æ¥åªæƒ³å†™ä¸€ç¯‡çš„ï¼Œä¸è¿‡æ„Ÿè§‰å¥½åƒæœ‰ç‚¹é•¿äº†ï¼Œè¿™æ ·çš„è¯å°±å†å†™ä¸€ç¯‡å§ï¼Œè¿™ç¯‡å°±å½“åšæ˜¯ç†è®ºçŸ¥è¯†çš„ä¸€ä¸ªè¡¥å……ï¼Œæ¥ä¸‹å»è®²è®²é¡ºç€å®é™…åº”ç”¨è¿‡ç¨‹çš„çº¿ç´¢ï¼Œä¸€æ­¥æ­¥æ˜¯å¦‚ä½•å°†æ¶ˆæ¯æ”¾å…¥&lt;strong&gt;MessageQueue&lt;/strong&gt;åˆ°æœ€åæ‰§è¡Œçš„~&lt;/p&gt;
</description>
        <pubDate>Wed, 25 Jan 2017 23:10:00 +0800</pubDate>
        <link>http://yourdomain.com/blog/2017/01/25/Android%E6%B6%88%E6%81%AF%E5%88%86%E5%8F%91%E5%8F%8A%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%88%87%E6%8D%A2%E4%B9%8BHandler-Message%E7%9A%84%E7%BB%86%E6%9E%9D%E6%9C%AB%E8%8A%82(%E4%B8%80).html</link>
        <guid isPermaLink="true">http://yourdomain.com/blog/2017/01/25/Android%E6%B6%88%E6%81%AF%E5%88%86%E5%8F%91%E5%8F%8A%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%88%87%E6%8D%A2%E4%B9%8BHandler-Message%E7%9A%84%E7%BB%86%E6%9E%9D%E6%9C%AB%E8%8A%82(%E4%B8%80).html</guid>
        
        
        <category>Blog</category>
        
      </item>
    
      <item>
        <title>androidç±»åŠ è½½æœºåˆ¶</title>
        <description>&lt;p&gt;æœ€è¿‘åœ¨æandroidæ’ä»¶åŒ–ï¼Œå…¶ä¸­æœ€æ ¸å¿ƒçš„ä¸€ç‚¹å°±æ˜¯å¦‚ä½•è®©æ’ä»¶apkè·‘èµ·æ¥ï¼Œå…¶å®å°±åˆ©ç”¨åŠ¨æ€åŠ è½½ï¼Œå°†æ’ä»¶ä¸­çš„ç±»åŠ è½½åˆ°hostä¸­ã€‚ä¹‹å‰ä¹Ÿçœ‹è¿‡androidç±»çš„åŠ è½½æœºåˆ¶ï¼Œæ„Ÿè§‰å¯¹äºæ•´ä¸ªè¿‡ç¨‹å¤§è‡´çœ‹æ‡‚äº†ï¼Œç„¶åå°±å¼€å§‹æ•´æ’ä»¶åŒ–ï¼Œç»“æœç¢°åˆ°é—®é¢˜äº†åˆæ„Ÿè§‰ä¸€çŸ¥åŠè§£çš„ï¼Œå¾ˆæ˜¯ä¸çˆ½ï¼Œç´¢æ€§æ”¾ä¸€æ”¾æ’ä»¶åŒ–ï¼Œå…ˆæŠŠandroidçš„ç±»åŠ è½½æœºåˆ¶çœ‹ä¸ªæ˜ç™½ã€‚è¿™é‡Œç»™è‡ªå·±æ€»ç»“ä¸‹ï¼ŒåŠ æ·±å°è±¡çš„åŒæ—¶ä¿ç•™ç¬”è®°ã€‚&lt;/p&gt;

&lt;p&gt;é¦–å…ˆéœ€è¦çŸ¥é“çš„æ˜¯androidä¸­ä¸¤ä¸ªä¸»è¦çš„classloaderï¼ŒPathClassLoaderå’ŒDexClassLoaderï¼Œå®ƒä»¬éƒ½ç»§æ‰¿è‡ªBaseDexClassLoaderï¼Œè¿™ä¸¤ä¸ªç±»æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿå…¶å®çœ‹ä¸€ä¸‹å®ƒä»¬çš„æºç æ³¨é‡Šå°±ä¸€ç›®äº†ç„¶äº†ã€‚
å› ä¸ºä»£ç å¾ˆå°‘ï¼Œçº¦ç­‰äºæ²¡æœ‰ï¼Œè¿™é‡Œç›´æ¥è´´å‡ºå®ƒä»¬çš„æºç ï¼Œå…¶å®ä¸»è¦æ˜¯æ³¨é‡Šï¼š&lt;/p&gt;

&lt;p&gt;&lt;em&gt;PathClassLoader&lt;/em&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;package dalvik.system;
/**
 * Provides a simple {@link ClassLoader} implementation that operates on a list
 * of files and directories in the local file system, but does not attempt to
 * load classes from the network. Android uses this class for its system class
 * loader and for its application class loader(s).
 */
public class PathClassLoader extends BaseDexClassLoader {
    /**
     * Creates a {@code PathClassLoader} that operates on a given list of files
     * and directories. This method is equivalent to calling
     * {@link #PathClassLoader(String, String, ClassLoader)} with a
     * {@code null} value for the second argument (see description there).
     *
     * @param dexPath the list of jar/apk files containing classes and
     * resources, delimited by {@code File.pathSeparator}, which
     * defaults to {@code &quot;:&quot;} on Android
     * @param parent the parent class loader
     */
    public PathClassLoader(String dexPath, ClassLoader parent) {
        super(dexPath, null, null, parent);
    }
    /**
     * Creates a {@code PathClassLoader} that operates on two given
     * lists of files and directories. The entries of the first list
     * should be one of the following:
     *
     * &amp;lt;ul&amp;gt;
     * &amp;lt;li&amp;gt;JAR/ZIP/APK files, possibly containing a &quot;classes.dex&quot; file as
     * well as arbitrary resources.
     * &amp;lt;li&amp;gt;Raw &quot;.dex&quot; files (not inside a zip file).
     * &amp;lt;/ul&amp;gt;
     *
     * The entries of the second list should be directories containing
     * native library files.
     *
     * @param dexPath the list of jar/apk files containing classes and
     * resources, delimited by {@code File.pathSeparator}, which
     * defaults to {@code &quot;:&quot;} on Android
     * @param libraryPath the list of directories containing native
     * libraries, delimited by {@code File.pathSeparator}; may be
     * {@code null}
     * @param parent the parent class loader
     */
    public PathClassLoader(String dexPath, String libraryPath,
            ClassLoader parent) {
        super(dexPath, null, libraryPath, parent);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;ç”±æ³¨é‡Šçœ‹å¯ä»¥å‘ç°PathClassLoaderè¢«ç”¨æ¥åŠ è½½æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œä½†ä¸èƒ½ä»ç½‘ç»œä¸ŠåŠ è½½ï¼Œ&lt;strong&gt;å…³é”®æ˜¯å®ƒè¢«ç”¨æ¥åŠ è½½ç³»ç»Ÿç±»å’Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åº&lt;/strong&gt;ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå®ƒçš„ä¸¤ä¸ªæ„é€ å‡½æ•°ä¸­è°ƒç”¨çˆ¶ç±»æ„é€ å™¨çš„æ—¶å€™ç¬¬äºŒä¸ªå‚æ•°ä¼ nullï¼Œå…·ä½“çš„å‚æ•°æ„ä¹‰è¯·çœ‹æ¥ä¸‹æ¥DexClassLoaderçš„æ³¨é‡Šã€‚&lt;/p&gt;

&lt;p&gt;&lt;em&gt;DexClassLoader&lt;/em&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;package dalvik.system;
import java.io.File;
/**
 * A class loader that loads classes from {@code .jar} and {@code .apk} files
 * containing a {@code classes.dex} entry. This can be used to execute code not
 * installed as part of an application.
 *
 * &amp;lt;p&amp;gt;This class loader requires an application-private, writable directory to
 * cache optimized classes. Use {@code Context.getDir(String, int)} to create
 * such a directory: &amp;lt;pre&amp;gt;   {@code
 *   File dexOutputDir = context.getDir(&quot;dex&quot;, 0);
 * }&amp;lt;/pre&amp;gt;
 *
 * &amp;lt;p&amp;gt;&amp;lt;strong&amp;gt;Do not cache optimized classes on external storage.&amp;lt;/strong&amp;gt;
 * External storage does not provide access controls necessary to protect your
 * application from code injection attacks.
 */
public class DexClassLoader extends BaseDexClassLoader {
    /**
     * Creates a {@code DexClassLoader} that finds interpreted and native
     * code.  Interpreted classes are found in a set of DEX files contained
     * in Jar or APK files.
     *
     * &amp;lt;p&amp;gt;The path lists are separated using the character specified by the
     * {@code path.separator} system property, which defaults to {@code :}.
     *
     * @param dexPath the list of jar/apk files containing classes and
     *     resources, delimited by {@code File.pathSeparator}, which
     *     defaults to {@code &quot;:&quot;} on Android
     * @param optimizedDirectory directory where optimized dex files
     *     should be written; must not be {@code null}
     * @param libraryPath the list of directories containing native
     *     libraries, delimited by {@code File.pathSeparator}; may be
     *     {@code null}
     * @param parent the parent class loader
     */
    public DexClassLoader(String dexPath, String optimizedDirectory,
            String libraryPath, ClassLoader parent) {
        super(dexPath, new File(optimizedDirectory), libraryPath, parent);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;DexClassLoaderç”¨æ¥åŠ è½½jarã€apkï¼Œå…¶å®è¿˜åŒ…æ‹¬zipæ–‡ä»¶æˆ–è€…ç›´æ¥åŠ è½½dexæ–‡ä»¶ï¼Œå®ƒå¯ä»¥è¢«ç”¨æ¥æ‰§è¡Œæœªå®‰è£…çš„ä»£ç æˆ–è€…æœªè¢«åº”ç”¨åŠ è½½è¿‡çš„ä»£ç ã€‚è¿™é‡Œä¹Ÿå†™å‡ºäº†å®ƒéœ€è¦çš„å››ä¸ªå‚æ•°çš„æ„æ€&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;dexPath:éœ€è¦è¢«åŠ è½½çš„æ–‡ä»¶åœ°å€ï¼Œå¯ä»¥å¤šä¸ªï¼Œç”¨File.pathSeparatoråˆ†å‰²&lt;/li&gt;
  &lt;li&gt;optimizedDirectory:dexæ–‡ä»¶è¢«åŠ è½½åä¼šè¢«ç¼–è¯‘å™¨ä¼˜åŒ–ï¼Œä¼˜åŒ–ä¹‹åçš„dexå­˜æ”¾è·¯å¾„ï¼Œ&lt;strong&gt;ä¸å¯ä»¥ä¸ºnull&lt;/strong&gt;ã€‚æ³¨æ„ï¼Œæ³¨é‡Šä¸­ä¹Ÿæåˆ°éœ€è¦ä¸€ä¸ªåº”ç”¨ç§æœ‰çš„å¯å†™çš„ä¸€ä¸ªè·¯å¾„ï¼Œä»¥é˜²æ­¢åº”ç”¨è¢«æ³¨å…¥æ”»å‡»ï¼Œå¹¶ä¸”ç»™å‡ºäº†ä¾‹å­      File dexOutputDir = context.getDir(â€œdexâ€, 0);&lt;/li&gt;
  &lt;li&gt;libraryPathï¼šåŒ…å«librariesçš„ç›®å½•åˆ—è¡¨ï¼Œpluginä¸­æœ‰soæ–‡ä»¶ï¼Œéœ€è¦å°†soæ‹·è´åˆ°sdå¡ä¸Šï¼Œç„¶åæŠŠsoæ‰€åœ¨çš„ç›®å½•å½“å‚æ•°ä¼ å…¥ï¼ŒåŒæ ·ç”¨File.pathSeparatoråˆ†å‰²ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä¼ nullå°±è¡Œäº†,ä¼šè‡ªåŠ¨åŠ ä¸Šç³»ç»Ÿsoåº“çš„å­˜æ”¾ç›®å½•&lt;/li&gt;
  &lt;li&gt;parentï¼šçˆ¶ç±»æ„é€ å™¨&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;è¿™é‡Œç€é‡çœ‹ä¸€ä¸‹ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¹‹å‰è¯´è¿‡PathClassLoaderä¸­è°ƒç”¨çˆ¶ç±»æ„é€ å™¨çš„æ—¶å€™è¿™ä¸ªå‚æ•°ç©¿äº†nullï¼Œå› ä¸ºåŠ è½½appåº”ç”¨çš„æ—¶å€™æˆ‘ä»¬çš„apkå·²ç»è¢«å®‰è£…åˆ°æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸Šäº†ï¼Œå…¶å†…éƒ¨çš„dexå·²ç»è¢«æå–å¹¶ä¸”æ‰§è¡Œè¿‡ä¼˜åŒ–äº†ï¼Œä¼˜åŒ–ä¹‹åæ”¾åœ¨ç³»ç»Ÿç›®å½•/data/dalvik-cacheä¸‹ã€‚&lt;/p&gt;

&lt;h4 id=&quot;section&quot;&gt;æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹ç±»çš„å…·ä½“åŠ è½½è¿‡ç¨‹&lt;/h4&gt;
&lt;p&gt;é¦–å…ˆçœ‹ä¸€æ®µå¦‚ä½•ä½¿ç”¨ç±»åŠ è½½å™¨åŠ è½½çš„è°ƒç”¨ä»£ç ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;	try {
            File file = view.getActivity().getDir(&quot;dex&quot;,0);
            String optimizedDirectory = file.getAbsolutePath();
            DexClassLoader loader = new DexClassLoader(&quot;éœ€è¦è¢«åŠ è½½çš„dexæ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„&quot;,optimizedDirectory,null,context.getClassLoader());
            loader.loadClass(&quot;éœ€è¦åŠ è½½çš„ç±»çš„å®Œå…¨é™å®šå&quot;);
        } catch (ClassNotFoundException e) {
            e.printStackTrace();
        }
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;è¿™é‡Œæˆ‘ä»¬å°±ç”¨äº†è‡ªå®šä¹‰äº†ä¸€ä¸ªDexClassLoaderLoaderï¼Œå¹¶ä¸”è°ƒç”¨äº†å®ƒçš„loadClassæ–¹æ³•ï¼Œè¿™æ ·ä¸€ä¸ªéœ€è¦è¢«ä½¿ç”¨çš„ç±»å°±è¢«æˆ‘ä»¬åŠ è½½è¿›æ¥äº†ï¼Œæ¥ä¸‹å»å°±å¯ä»¥æ­£å¸¸ä½¿ç”¨è¿™ä¸ªç±»äº†ï¼Œå…·ä½“æ€ä¹ˆä½¿ç”¨æˆ‘å°±ä¸å¤šè¯´äº†ï¼Œæˆ‘ä»¬è¿˜æ˜¯æ¥ç ”ç©¶ç ”ç©¶è¿™ä¸ªç±»æ˜¯æ€ä¹ˆè¢«åŠ è½½è¿›æ¥çš„å§~&lt;/p&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ°new DexClassLoaderçš„æ—¶å€™æˆ‘ä»¬ç”¨äº†4ä¸ªå‚æ•°ï¼Œå‚æ•°æ„ä¹‰ä¸Šé¢å·²ç»è®²è¿‡äº†ï¼Œä»ä¸Šé¢çš„æºç ä¸­å¯ä»¥çœ‹åˆ°DexClassLoaderçš„æ„é€ å™¨ä¸­ç›´æ¥è°ƒç”¨äº†çˆ¶ç±»çš„æ„é€ å™¨ï¼Œåªæ˜¯å°†optimizedDirectoryè·¯å¾„å°è£…æˆä¸€ä¸ªFileï¼Œå…·ä½“è¿™äº›å‚æ•°æ˜¯å¦‚ä½•è¢«ä½¿ç”¨çš„å‘¢ï¼Œæˆ‘ä»¬å¾€ä¸‹çœ‹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;BaseDexClassLoaderç±»çš„æ„é€ å™¨&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;	/**
     * Constructs an instance.
     *
     * @param dexPath the list of jar/apk files containing classes and
     * resources, delimited by {@code File.pathSeparator}, which
     * defaults to {@code &quot;:&quot;} on Android
     * @param optimizedDirectory directory where optimized dex files
     * should be written; may be {@code null}
     * @param libraryPath the list of directories containing native
     * libraries, delimited by {@code File.pathSeparator}; may be
     * {@code null}
     * @param parent the parent class loader
     */
  public BaseDexClassLoader(String dexPath, File optimizedDirectory,
            String libraryPath, ClassLoader parent) {
        super(parent);
        this.originalPath = dexPath;
        this.pathList =
            new DexPathList(this, dexPath, libraryPath, optimizedDirectory);
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;é¦–å…ˆä¹Ÿæ˜¯è°ƒç”¨äº†çˆ¶ç±»çš„æ„é€ å™¨ï¼Œä½†è¿™é‡Œåªå°†parentä¼ ç»™çˆ¶ç±»ï¼Œå³ClassLoaderï¼ŒClassLoaderä¸­åšçš„ä¹Ÿå¾ˆå¾ˆç®€å•ï¼Œå®ƒå†…éƒ¨æœ‰ä¸ªparentå±æ€§ï¼Œæ­£å¥½ä¿å­˜ä¼ è¿›æ¥çš„å‚æ•°parent,è¿™é‡Œå¯ä»¥ç¨å¾®çœ‹ä¸€ä¸‹ç¬¬ä¸‰ä¸ªå‚æ•°çš„æ³¨é‡Šï¼Œæœ€åä¸€å¥è¯´åˆ°å¯ä»¥ä¸ºnullï¼Œè€Œæ˜¯å¦ä¸ºnullåˆåˆšå¥½æ˜¯PathClassLoaderå’ŒDexClassLoaderçš„åŒºåˆ«ï¼Œé‚£æ˜¯å¦ä¸ºnullæœ€ç»ˆåˆæ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿå–ä¸ªå…³å­å…ˆ~&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;	protected ClassLoader(ClassLoader parentLoader) {
        this(parentLoader, false);
    }

    ClassLoader(ClassLoader parentLoader, boolean nullAllowed) {
        if (parentLoader == null &amp;amp;&amp;amp; !nullAllowed) {
            throw new NullPointerException(&quot;parentLoader == null &amp;amp;&amp;amp; !nullAllowed&quot;);
        }
        parent = parentLoader;
    }

&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;æ¥ä¸‹å»BaseDexClassLoaderç»™originalPath å’Œ pathListèµ‹äº†å€¼ï¼ŒoriginalPathå°±æ˜¯æˆ‘ä»¬ä¼ è¿›å…¥çš„dexæ–‡ä»¶è·¯å¾„ï¼ŒpathList æ˜¯ä¸€ä¸ªnew å‡ºæ¥çš„DexPathListå¯¹è±¡ï¼Œè¿™ä¸ªDexPathListåˆæ˜¯ä½•æ–¹ç¥åœ£ï¼Ÿä¸”å¬æ…¢æ…¢é“æ¥ã€‚&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; /**
     * Constructs an instance.
     *
     * @param definingContext the context in which any as-yet unresolved
     * classes should be defined
     * @param dexPath list of dex/resource path elements, separated by
     * {@code File.pathSeparator}
     * @param libraryPath list of native library directory path elements,
     * separated by {@code File.pathSeparator}
     * @param optimizedDirectory directory where optimized {@code .dex} files
     * should be found and written to, or {@code null} to use the default
     * system directory for same
     */
    public DexPathList(ClassLoader definingContext, String dexPath,
            String libraryPath, File optimizedDirectory) {
        if (definingContext == null) {
            throw new NullPointerException(&quot;definingContext == null&quot;);
        }
        if (dexPath == null) {
            throw new NullPointerException(&quot;dexPath == null&quot;);
        }
        if (optimizedDirectory != null) {
            if (!optimizedDirectory.exists())  {
                throw new IllegalArgumentException(
                        &quot;optimizedDirectory doesn&#39;t exist: &quot;
                        + optimizedDirectory);
            }
            if (!(optimizedDirectory.canRead()
                            &amp;amp;&amp;amp; optimizedDirectory.canWrite())) {
                throw new IllegalArgumentException(
                        &quot;optimizedDirectory not readable/writable: &quot;
                        + optimizedDirectory);
            }
        }
        this.definingContext = definingContext;
        this.dexElements =
            makeDexElements(splitDexPath(dexPath), optimizedDirectory);
        this.nativeLibraryDirectories = splitLibraryPath(libraryPath);
    }

&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;åˆ«çš„å…ˆä¸è¯´ï¼Œå…ˆçœ‹æ³¨é‡Šã€‚ç¬¬å››ä¸ªå‚æ•°ä¸­è¯´åˆ°å¦‚æœoptimizedDirectory ä¸ºnullåˆ™ä½¿ç”¨ç³»ç»Ÿé»˜è®¤è·¯å¾„ä»£æ›¿ï¼Œè¿™ä¸ªé»˜è®¤è·¯å¾„ä¹Ÿå°±æ˜¯/data/dalvik-cache/ç›®å½•ï¼Œè¿™ä¸ªä¸€èˆ¬æƒ…å†µä¸‹æ˜¯æ²¡æœ‰æƒé™å»è®¿é—®çš„ï¼Œæ‰€ä»¥è¿™ä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆæˆ‘ä»¬åªèƒ½ç”¨DexClassLoaderå»åŠ è½½ç±»è€Œä¸ç”¨PathClassLoaderã€‚&lt;/p&gt;

&lt;p&gt;ç„¶åæ¥ç€çœ‹ä»£ç ï¼Œæ˜¾ç„¶ï¼Œå‰é¢ä¸‰ä¸ªifåˆ¤æ–­éƒ½æ˜¯ç”¨æ¥éªŒè¯å‚æ•°çš„åˆæ³•æ€§çš„ï¼Œä¹‹ååŒæ ·åªæ˜¯åšäº†ä¸‰ä¸ªèµ‹å€¼æ“ä½œï¼Œç¬¬ä¸€ä¸ªå°±ä¸è¯´äº†ï¼Œä¿å­˜äº†å®ä¾‹åŒ–DexPathListçš„classloaderï¼Œç¬¬äºŒä¸ªå‚æ•°çš„å£°æ˜æ˜¯ä¸€ä¸ªElementæ•°ç»„,ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯libåº“çš„ç›®å½•æ–‡ä»¶æ•°ç»„ï¼Œ&lt;/p&gt;

&lt;p&gt;```
 private final Element[] dexElements;
 private final File[] nativeLibraryDirectories;&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;çœ‹å®ƒä»¬ä¹‹å‰å…ˆçœ‹çœ‹å‡ ä¸ªsplitå°å‡½æ•°ï¼š&lt;/p&gt;

 	private static ArrayList&lt;File&gt; splitDexPath(String path) {
&lt;/File&gt;&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    return splitPaths(path, null, false);
}

private static File[] splitLibraryPath(String path) {
    ArrayList&amp;lt;File&amp;gt; result = splitPaths(
            path, System.getProperty(&quot;java.library.path&quot;, &quot;.&quot;), true);
    return result.toArray(new File[result.size()]);
} 
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;è¿™ä¸¤ä¸ªé¡¾åæ€ä¹‰å°±æ˜¯æ‹¿æ¥åˆ†å‰²dexPathå’ŒlibPathï¼Œå®ƒä»¬å†…éƒ¨éƒ½è°ƒç”¨äº†splitPathsæ–¹æ³•ï¼Œåªæ˜¯ä¸‰ä¸ªå‚æ•°ä¸ä¸€æ ·ï¼Œå…¶ä¸­splitLibraryPathæ–¹æ³•ä¸­è°ƒç”¨splitPathsæ—¶çš„ç¬¬äºŒä¸ªå‚æ•°ä»¿ä½›åˆé€éœ²äº†ä»€ä¹ˆä¿¡æ¯ï¼Œæ²¡é”™ï¼Œä¹‹å‰ä»‹ç»DexClassLoaderå‚æ•°ä¸­çš„libraryPathçš„æ—¶å€™è¯´è¿‡ï¼Œä¼šåŠ ä¸Šç³»ç»Ÿsoåº“çš„å­˜æ”¾ç›®å½•ï¼Œå°±æ˜¯åœ¨è¿™ä¸ªæ—¶å€™æ·»åŠ ä¸Šå»çš„ã€‚&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; 	private static ArrayList&amp;lt;File&amp;gt; splitPaths(String path1, String path2,
            boolean wantDirectories) {
        ArrayList&amp;lt;File&amp;gt; result = new ArrayList&amp;lt;File&amp;gt;();
        splitAndAdd(path1, wantDirectories, result);
        splitAndAdd(path2, wantDirectories, result);
        return result;
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;ä»€ä¹ˆå•Šï¼ŒåŸæ¥è¿™ä¸ªæ–¹æ³•ä¹Ÿæ²¡åšä»€ä¹ˆäº‹å•Šï¼Œåªæ˜¯æŠŠå‚æ•°path1å’Œå‚æ•°path2åˆåˆ†åˆ«è°ƒç”¨äº†ä¸‹splitAndAddæ–¹æ³•ï¼Œä½†æ˜¯è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªArrayList,è€Œä¸”è°ƒç”¨splitAndAddæ–¹æ³•çš„æ—¶å€™éƒ½å½“å‚æ•°ä¼ å…¥äº†ï¼Œå¹¶ä¸”æœ€ç»ˆè¿”å›äº†è¿™ä¸ªlistï¼Œæ‰€ä»¥æˆ‘ä»¬å¤§èƒ†çŒœæµ‹ä¸‹ï¼Œpath1å’Œpath2æœ€åè¢«åˆ†å‰²åçš„å€¼éƒ½å­˜æ”¾åœ¨äº†listä¸­è¿”å›,çœ‹ä¸‹æ˜¯ä¸æ˜¯è¿™ä¹ˆä¸€å›äº‹å§ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;	private static void splitAndAdd(String path, boolean wantDirectories,
            ArrayList&amp;lt;File&amp;gt; resultList) {
        if (path == null) {
            return;
        }
        String[] strings = path.split(Pattern.quote(File.pathSeparator));
        for (String s : strings) {
            File file = new File(s);
            if (! (file.exists() &amp;amp;&amp;amp; file.canRead())) {
                continue;
            }
            /*
             * Note: There are other entities in filesystems than
             * regular files and directories.
             */
            if (wantDirectories) {
                if (!file.isDirectory()) {
                    continue;
                }
            } else {
                if (!file.isFile()) {
                    continue;
                }
            }
            resultList.add(file);
        }
    }
 ```
 æœç„¶ï¼Œè·Ÿæˆ‘ä»¬çŒœçš„ä¸€æ ·ï¼Œåªæ˜¯åˆåŠ ä¸Šäº†æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä»¥åŠæ˜¯å¦å¯è¯»çš„éªŒè¯ï¼Œç„¶åæ ¹æ®å‚æ•°wantDirectoriesåˆ¤æ–­æ˜¯å¦æ–‡ä»¶ç±»å‹æ˜¯è¢«éœ€è¦çš„ç±»å‹ï¼Œæœ€ç»ˆåŠ å…¥listã€‚ç°åœ¨æˆ‘ä»¬å›è¿‡å¤´å»çœ‹çœ‹splitDexPathæ–¹æ³•å’ŒsplitLibraryPathæ–¹æ³•ï¼Œæ˜¯ä¸æ˜¯ä¸€ç›®äº†ç„¶äº†ã€‚
 
 å†å¾€ä¸Šçœ‹DexPathListçš„æ„é€ å™¨ï¼ŒnativeLibraryDirectoriesçš„æœ€ç»ˆå€¼ä¹Ÿå·²ç»çŸ¥é“äº†ï¼Œå°±å·®dexElementsäº†ï¼ŒmakeDexElementsæ–¹æ³•çš„ä¸¤ä¸ªå‚æ•°æˆ‘ä»¬ä¹Ÿå·²ç»çŸ¥é“äº†ï¼Œé‚£æˆ‘ä»¬å°±çœ‹çœ‹makeDexElementséƒ½å¹²äº†äº›ä»€ä¹ˆå§ã€‚
 
 ```
  	private static Element[] makeDexElements(ArrayList&amp;lt;File&amp;gt; files,
            File optimizedDirectory) {
        ArrayList&amp;lt;Element&amp;gt; elements = new ArrayList&amp;lt;Element&amp;gt;();
        /*
         * Open all files and load the (direct or contained) dex files
         * up front.
         */
        for (File file : files) {
            ZipFile zip = null;
            DexFile dex = null;
            String name = file.getName();
            if (name.endsWith(DEX_SUFFIX)) {
                // Raw dex file (not inside a zip/jar).
                try {
                    dex = loadDexFile(file, optimizedDirectory);
                } catch (IOException ex) {
                    System.logE(&quot;Unable to load dex file: &quot; + file, ex);
                }
            } else if (name.endsWith(APK_SUFFIX) || name.endsWith(JAR_SUFFIX)
                    || name.endsWith(ZIP_SUFFIX)) {
                try {
                    zip = new ZipFile(file);
                } catch (IOException ex) {
                    /*
                     * Note: ZipException (a subclass of IOException)
                     * might get thrown by the ZipFile constructor
                     * (e.g. if the file isn&#39;t actually a zip/jar
                     * file).
                     */
                    System.logE(&quot;Unable to open zip file: &quot; + file, ex);
                }
                try {
                    dex = loadDexFile(file, optimizedDirectory);
                } catch (IOException ignored) {
                    /*
                     * IOException might get thrown &quot;legitimately&quot; by
                     * the DexFile constructor if the zip file turns
                     * out to be resource-only (that is, no
                     * classes.dex file in it). Safe to just ignore
                     * the exception here, and let dex == null.
                     */
                }
            } else {
                System.logW(&quot;Unknown file type for: &quot; + file);
            }
            if ((zip != null) || (dex != null)) {
                elements.add(new Element(file, zip, dex));
            }
        }
        return elements.toArray(new Element[elements.size()]);
    }
 ```
 æ–¹æ³•ä¹Ÿä¸é•¿ï¼Œæˆ‘ä»¬ä¸€æ®µæ®µçœ‹ä¸‹å»ã€‚é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªelememt åˆ—è¡¨ï¼Œç„¶åéå†ç”±dexpathåˆ†å‰²å¾—æ¥çš„æ–‡ä»¶åˆ—è¡¨ï¼Œå…¶å®ä¸€èˆ¬ä½¿ç”¨åœºæ™¯ä¸‹ä¹Ÿå°±ä¸€ä¸ªæ–‡ä»¶ã€‚å¾ªç¯é‡Œé¢é’ˆå¯¹æ¯ä¸ªfile å£°æ˜ä¸€ä¸ªzipfileå’Œä¸€ä¸ªdexfileï¼Œåˆ¤æ–­fileçš„æ–‡ä»¶åç¼€åï¼Œå¦‚æœæ˜¯&quot;.dex&quot;åˆ™ä½¿ç”¨loadDexFileæ–¹æ³•ç»™dexèµ‹å€¼ï¼Œå¦‚æœæ˜¯â€œ.apkâ€,â€œ.jarâ€,â€œ.zipâ€æ–‡ä»¶çš„åˆ™æŠŠfileåŒ…è£…æˆzipfileèµ‹å€¼ç»™zipï¼Œç„¶ååŒæ ·æ˜¯ç”¨loadDexFileæ–¹æ³•ç»™dexèµ‹å€¼ï¼Œå¦‚æœæ˜¯å…¶ä»–æƒ…å†µåˆ™ä¸åšå¤„ç†ï¼Œæ‰“å°æ—¥å¿—è¯´æ˜æ–‡ä»¶ç±»å‹ä¸æ”¯æŒï¼Œè€Œä¸”ä¸‹ä¸€ä¸ªifåˆ¤æ–­ä¸­ç”±äºzipå’Œdexéƒ½æœªæ›¾èµ‹å€¼ï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šæ·»åŠ åˆ°elementsåˆ—è¡¨ä¸­å»ã€‚æ³¨æ„ä¸‹ï¼šè¿™é‡Œæ‰€è°“çš„æ–‡ä»¶ç±»å‹ä»…ä»…æ˜¯æŒ‡æ–‡ä»¶çš„åç¼€åè€Œå·²ï¼Œå¹¶ä¸æ˜¯æ–‡ä»¶çš„å®é™…ç±»å‹ï¼Œæ¯”å¦‚æˆ‘ä»¬å°†.zipæ–‡ä»¶åç¼€æ”¹æˆ.txtï¼Œé‚£ä¹ˆå°±ä¸æ”¯æŒè¿™ä¸ªæ–‡ä»¶äº†ã€‚è€Œä¸”æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¯¹äºdexpathç›®å‰åªæ”¯æŒâ€œ.dexâ€ã€â€œ.jarâ€ã€â€œ.apkâ€ã€â€œ.zipâ€è¿™å››ç§ç±»å‹ã€‚
 
 ç°åœ¨è¿˜å‰©ä¸‹ä¸¤ä¸ªä¸œè¥¿å¯èƒ½è¿˜ä¸å¤ªæ˜ç¡®ï¼Œä¸€ä¸ªæ˜¯ä»€ä¹ˆæ˜¯DexFileä»¥åŠè¿™é‡Œçš„loadDexFileæ–¹æ³•æ˜¯å¦‚ä½•åˆ›å»ºdexfileå®ä¾‹çš„ï¼Œå¦ä¸€ä¸ªæ˜¯ä»€ä¹ˆæ˜¯Elememtï¼Œçœ‹äº†ä¸‹Elementæºç ï¼Œå“ˆå“ˆï¼Œso easyï¼Œå°±æ˜¯ä¸€ä¸ªç®€å•çš„æ•°æ®ç»“æ„ä½“åŠ ä¸€ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å…ˆç®€å•æŠŠå®ƒå½“åšä¸€ä¸ªå­˜å‚¨äº†fileï¼Œzipï¼Œdexä¸‰ä¸ªå­—æ®µçš„ä¸€ä¸ªå®ä½“ç±»ã€‚é‚£ä¹ˆå°±å‰©ä¸‹DexFileäº†ã€‚
 
 
 ```
 	private static DexFile loadDexFile(File file, File optimizedDirectory)
            throws IOException {
        if (optimizedDirectory == null) {
            return new DexFile(file);
        } else {
            String optimizedPath = optimizedPathFor(file, optimizedDirectory);
            return DexFile.loadDex(file.getPath(), optimizedPath, 0);
        }
    }
    
    
 ```
 å¾ˆç®€æ´ï¼Œå¦‚æœoptimizedDirectory == nullåˆ™ç›´æ¥new ä¸€ä¸ªDexFileï¼Œå¦åˆ™å°±ä½¿ç”¨DexFile.loadDexæ¥åˆ›å»ºä¸€ä¸ªDexFileå®ä¾‹ã€‚
 
 ```
 /**
     * Converts a dex/jar file path and an output directory to an
     * output file path for an associated optimized dex file.
     */
    private static String optimizedPathFor(File path,
            File optimizedDirectory) {
        /*
         * Get the filename component of the path, and replace the
         * suffix with &quot;.dex&quot; if that&#39;s not already the suffix.
         *
         * We don&#39;t want to use &quot;.odex&quot;, because the build system uses
         * that for files that are paired with resource-only jar
         * files. If the VM can assume that there&#39;s no classes.dex in
         * the matching jar, it doesn&#39;t need to open the jar to check
         * for updated dependencies, providing a slight performance
         * boost at startup. The use of &quot;.dex&quot; here matches the use on
         * files in /data/dalvik-cache.
         */
        String fileName = path.getName();
        if (!fileName.endsWith(DEX_SUFFIX)) {
            int lastDot = fileName.lastIndexOf(&quot;.&quot;);
            if (lastDot &amp;lt; 0) {
                fileName += DEX_SUFFIX;
            } else {
                StringBuilder sb = new StringBuilder(lastDot + 4);
                sb.append(fileName, 0, lastDot);
                sb.append(DEX_SUFFIX);
                fileName = sb.toString();
            }
        }
        File result = new File(optimizedDirectory, fileName);
        return result.getPath();
    }
 ```
 è¿™ä¸ªæ–¹æ³•è·å–è¢«åŠ è½½çš„dexpathçš„æ–‡ä»¶åï¼Œå¦‚æœä¸æ˜¯â€œ.dexâ€ç»“å°¾çš„å°±æ”¹æˆâ€œ.dexâ€ç»“å°¾ï¼Œç„¶åç”¨optimizedDirectoryå’Œæ–°çš„æ–‡ä»¶åæ„é€ ä¸€ä¸ªFileå¹¶è¿”å›è¯¥Fileçš„è·¯å¾„ï¼Œæ‰€ä»¥DexFile.loadDexæ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°å…¶å®æ˜¯dexpathæ–‡ä»¶å¯¹åº”çš„ä¼˜åŒ–æ–‡ä»¶çš„è¾“å‡ºè·¯å¾„ã€‚æ¯”å¦‚æˆ‘è¦åŠ è½½ä¸€ä¸ªdexpathä¸ºâ€œsdcard/coder_yu/plugin.apkâ€ï¼ŒoptimizedDirectory ä¸ºä½¿ç”¨èŒƒä¾‹ä¸­çš„ç›®å½•çš„è¯ï¼Œé‚£ä¹ˆæœ€ç»ˆä¼˜åŒ–åçš„è¾“å‡ºè·¯å¾„ä¸º/data/user/0/com.coder_yu.test/app_dex/plugin.dex,å…·ä½“çš„ç›®å½•åœ¨ä¸åŒæœºå‹ä¸åŒromä¸‹æœ‰å¯èƒ½ä¼šä¸ä¸€æ ·ã€‚
 
æ˜¯æ—¶å€™çœ‹çœ‹DexFileäº†ã€‚åœ¨ä¸Šé¢çš„loadDexFileæ–¹æ³•ä¸­æˆ‘ä»¬çœ‹åˆ°optimizedDirectoryå‚æ•°ä¸ºnullçš„æ—¶å€™ç›´æ¥è¿”å›new DexFileï¼ˆfileï¼‰äº†ï¼Œå¦åˆ™è¿”å› DexFile.loadDex(file.getPath(), optimizedPath, 0)ï¼Œä½†å…¶å®ä»–ä»¬æœ€ç»ˆéƒ½æ˜¯ä½¿ç”¨äº†ç›¸åŒæ–¹æ³•å»åŠ è½½dexpathæ–‡ä»¶ï¼Œå› ä¸ºDexFile.loadDexæ–¹æ³•å†…éƒ¨ä¹Ÿæ˜¯ç›´æ¥è°ƒç”¨çš„äº†DexFileçš„æ„é€ å™¨ï¼Œä»¥ä¸‹ï¼š
 
 ```
 	static public DexFile loadDex(String sourcePathName, String outputPathName,
        int flags) throws IOException {
        return new DexFile(sourcePathName, outputPathName, flags);
    }
 ```
 ç„¶åçœ‹çœ‹DexFileçš„æ„é€ å™¨å§
 
 ```
 
 	public DexFile(File file) throws IOException {
        this(file.getPath());
    }
    /**
     * Opens a DEX file from a given filename. This will usually be a ZIP/JAR
     * file with a &quot;classes.dex&quot; inside.
     *
     * The VM will generate the name of the corresponding file in
     * /data/dalvik-cache and open it, possibly creating or updating
     * it first if system permissions allow.  Don&#39;t pass in the name of
     * a file in /data/dalvik-cache, as the named file is expected to be
     * in its original (pre-dexopt) state.
     *
     * @param fileName
     *            the filename of the DEX file
     *
     * @throws IOException
     *             if an I/O error occurs, such as the file not being found or
     *             access rights missing for opening it
     */
    public DexFile(String fileName) throws IOException {
        mCookie = openDexFile(fileName, null, 0);
        mFileName = fileName;
        guard.open(&quot;close&quot;);
        //System.out.println(&quot;DEX FILE cookie is &quot; + mCookie);
    }
    
    private DexFile(String sourceName, String outputName, int flags) throws IOException {
        mCookie = openDexFile(sourceName, outputName, flags);
        mFileName = sourceName;
        guard.open(&quot;close&quot;);
        //System.out.println(&quot;DEX FILE cookie is &quot; + mCookie);
    }
 ```
 å¯ä»¥çœ‹åˆ°ç›´æ¥new DexFileï¼ˆfileï¼‰å’ŒDexFile.loadDex(file.getPath(), optimizedPath, 0)æœ€ç»ˆéƒ½æ˜¯è°ƒç”¨äº†openDexFileï¼ˆsourceNameï¼Œ outputName, flags)æ–¹æ³•ï¼Œåªæ˜¯ç›´æ¥newçš„æ–¹å¼optimizedPathå‚æ•°ä¸ºnullï¼Œè¿™æ ·openDexFileæ–¹æ³•ä¼šé»˜è®¤ä½¿ç”¨ /data/dalvik-cacheç›®å½•ä½œä¸ºä¼˜åŒ–åçš„è¾“å‡ºç›®å½•ï¼Œç¬¬äºŒä¸ªæ„é€ å™¨çš„æ³¨é‡Šä¸­å†™çš„å¾ˆæ˜ç™½äº†ã€‚mCookieæ˜¯ä¸€ä¸ªintå€¼ï¼Œä¿å­˜äº†openDexFileæ–¹æ³•çš„è¿”å›å€¼ï¼ŒopenDexFileæ–¹æ³•æ˜¯ä¸€ä¸ªnativeæ–¹æ³•ï¼Œæˆ‘ä»¬å°±ä¸æ·±å…¥äº†ï¼Œæˆ‘è‡ªå·±ä¹Ÿå°±çœ‹äº†ä¸ªå¤§æ¦‚ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥çœ‹ä¸‹è¿™ç¯‡æ–‡ç« :
 &amp;lt;http://blog.csdn.net/zhoushishang/article/details/38703623&amp;gt;
 è¿™æ ·æ€»ç®—æ˜¯åˆ›å»ºäº†ä¸€ä¸ªDexClassLoaderã€‚
 
##### æˆ‘ä»¬å›é¡¾ä¸€ä¸‹:ä»new DexClassLoader(dexPath,optimizedDirectory,libraryPath,parentLoader)å¼€å§‹,è°ƒç”¨çˆ¶ç±»BaseDexClassLoaderæ„é€ å™¨ï¼Œç”¨originalPath ä¿å­˜äº† dexPathï¼ŒpathListä¿å­˜äº†ä¸€ä¸ªç”±dexPathã€optimizedDirectoryã€libraryPathã€loaderå››ä¸ªå‚æ•°æ„å»ºçš„DexPathListï¼ŒDexPathListä¸­çš„definingContext ä¿å­˜äº†parentLoaderï¼ŒoptimizedDirectoryå’ŒlibraryPathä¼šè¢«åˆ†å‰²æˆæ•°ç»„ï¼Œå…¶ä¸­nativeLibraryDirectoriesä¿å­˜äº†libraryPathè¢«åˆ†å‰²åçš„æ•°ç»„ï¼Œå¹¶ä¸”åŠ ä¸Šäº†ç³»ç»Ÿsoåº“çš„ç›®å½•ï¼ŒdexElementsä¿å­˜äº†ç”±dexPathè¢«åˆ†å‰²åçš„å¯¹åº”çš„fileè€Œåˆ›å»ºçš„Elememtï¼Œå®ƒåªæ˜¯ä¸€ä¸ªç®€å•å®ä½“ç±»ï¼Œç”±ä¸€ä¸ªFileï¼Œä¸€ä¸ªZipFileï¼Œä¸€ä¸ªDexFileç»„æˆï¼ŒZipFileæ˜¯ç”±jarã€zipã€apkå½¢å¼çš„fileåŒ…è£…æˆè€Œæ¥ï¼ŒDexFileä½¿ç”¨nativeæ–¹æ³•openDexFileæ‰“å¼€äº†å…·ä½“çš„fileå¹¶è¾“å‡ºåˆ°ä¼˜åŒ–è·¯å¾„ã€‚
![image](classloaderÂ å…³ç³»å›¾.jpg)

---
DexClassLoaderçš„åˆ›å»ºè¿‡ç¨‹æˆ‘ä»¬å·²ç»çœ‹å®Œäº†ï¼Œçœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å»æ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„ç±»çš„å§ï¼

å…ˆæŠŠä½¿ç”¨èŒƒä¾‹å†è´´ä¸€é

&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;try {
        File file = view.getActivity().getDir(&quot;dex&quot;,0);
        String optimizedDirectory = file.getAbsolutePath();
        DexClassLoader loader = new DexClassLoader(&quot;éœ€è¦è¢«åŠ è½½çš„dexæ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„&quot;,optimizedDirectory,null,context.getClassLoader());
        loader.loadClass(&quot;éœ€è¦åŠ è½½çš„ç±»çš„å®Œå…¨é™å®šå&quot;);
    } catch (ClassNotFoundException e) {
        e.printStackTrace();
    } ``` æˆ‘ä»¬å·²ç»æ‹¿åˆ°loaderäº†ï¼Œç„¶åå°±æ˜¯loader.loadClass(&quot;éœ€è¦åŠ è½½çš„ç±»çš„å®Œå…¨é™å®šå&quot;)ï¼Œæˆ‘ä»¬å‡è®¾éœ€è¦è¢«åŠ è½½çš„ç±»ä¸º &#39;com.coder_yu.plugin.Test&#39;,ä¹Ÿå³æ˜¯loader.loadClass(&quot;com.coder_yu.plugin.Test&quot;),æ‰€ä»¥æˆ‘ä»¬å…ˆå»DexClassLoaderä¸­çœ‹çœ‹loaderClassæ–¹æ³•ï¼Œä¸è¿‡å¥½åƒæ²¡æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œé‚£å°±å»å®ƒçš„çˆ¶ç±»BaseDexClassLoaderä¸­çœ‹çœ‹ï¼Œè¿˜æ˜¯ æ²¡æœ‰ï¼Œé‚£å°±å†å¾€ä¸Šèµ°ï¼Œå»ClassLoaderç±»é‡Œé¢æ‰¾ï¼Œæ€»ç®—æ‰¾åˆ°äº†ï¼š

 public Class&amp;lt;?&amp;gt; loadClass(String className) throws ClassNotFoundException {
    return loadClass(className, false);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;ç›´æ¥è°ƒç”¨å¦ä¸€ä¸ªloadclassæ–¹æ³•ï¼Œçœ‹ä¸€ä¸‹ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; 	protected Class&amp;lt;?&amp;gt; loadClass(String className, boolean resolve) throws ClassNotFoundException {
        Class&amp;lt;?&amp;gt; clazz = findLoadedClass(className);

        if (clazz == null) {
            ClassNotFoundException suppressed = null;
            try {
                clazz = parent.loadClass(className, false);
            } catch (ClassNotFoundException e) {
                suppressed = e;
            }

            if (clazz == null) {
                try {
                    clazz = findClass(className);
                } catch (ClassNotFoundException e) {
                    e.addSuppressed(suppressed);
                    throw e;
                }
            }
        }

        return clazz;
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;ç›´æ¥è°ƒç”¨findLoadedClassæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šå»è™šæ‹Ÿæœºä¸­æ‰¾å½“å‰classloaderæ˜¯å¦å·²ç»åŠ è½½è¿‡è¯¥classäº†ï¼Œå¦‚æœåŠ è½½è¿‡äº†åˆ™ç›´æ¥è¿”å›è¿™ä¸ªclassï¼Œå¦åˆ™è¿”å›nullï¼Œå¹¶å»è°ƒç”¨parentçš„loadClassæ–¹æ³•ï¼Œä¾æ¬¡ç±»æ¨ï¼Œä¼šä¸€ç›´æ‰¾åˆ°æ ¹classloaderçš„findLoadedClassæ–¹æ³•ï¼Œå› ä¸ºæˆ‘ä»¬è¿™é‡Œæ˜¯ç¬¬ä¸€æ¬¡å»åŠ è½½sdå¡ä¸Šçš„è‡ªå®šä¹‰æ’ä»¶ï¼Œæ‰€ä»¥è‚¯å®šæ²¡è¢«åŠ è½½è¿‡ï¼Œé‚£ä¹ˆç›´åˆ°æ ¹classloader.findLoadedClasså°†ä¸€ç›´è¿”å›nullï¼Œç„¶åä¼šå»è°ƒ findClass(className)æ–¹æ³•ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹findLoadedClassæ–¹æ³•å§ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; protected final Class&amp;lt;?&amp;gt; findLoadedClass(String className) {
        ClassLoader loader;
        if (this == BootClassLoader.getInstance())
            loader = null;
        else
            loader = this;
        return VMClassLoader.findLoadedClass(loader, className);
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;BootClassLoaderæ˜¯ClassLoaderçš„é»˜è®¤parentloaderï¼Œæ‰€ä»¥å®ƒæ˜¯åŠ è½½å™¨é“¾ä¸­çš„é¡¶ç«¯ï¼Œä¹Ÿå°±æ˜¯classloaderçš„æ ¹èŠ‚ç‚¹ï¼Œå› æ­¤å®ƒä¼šæœ€ç»ˆä»£ç†ä¸€äº›æ–¹æ³•åˆ°è™šæ‹Ÿæœºå»æ‰§è¡Œï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å»çœ‹ä¸‹ClassLoaderçš„æºç ã€‚è¿™é‡Œè¯´ä¸€ä¸‹ï¼Œå…¶å®æ ¹èŠ‚ç‚¹æˆ‘ä»¬åˆšæ‰è¯´äº†æ˜¯BootClassLoaderï¼Œè€Œä¸”å®ƒé‡å†™äº†loadClassæ–¹æ³•ï¼Œå› ä¸ºå®ƒæ²¡æœ‰parentloaderï¼Œæ‰€ä»¥å®ƒæ²¡æœ‰å†å»è°ƒç”¨parent.loadClass(className, false)ï¼Œè€Œæ˜¯ç›´æ¥è°ƒç”¨findClassæ–¹æ³•ï¼Œè€ŒfindClassæ–¹æ³•ä¸­ä¹Ÿæ˜¯ç›´æ¥è¿”å›Class.classForName(name, false, null)å¾—åˆ°çš„å€¼ï¼Œæ˜¾ç„¶ç»“æœæ˜¯nullã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬æ„é€ DexClassLoaderçš„æ—¶å€™ç»™çš„parentloaderå‚æ•°æ˜¯context.getClassLoader()ï¼Œå®ƒå…¶å®å°±æ˜¯åŠ è½½æˆ‘ä»¬åº”ç”¨çš„ç±»åŠ è½½å™¨ï¼Œä¹Ÿå°±æ˜¯PathClassLoaderï¼Œå®ƒçš„parentloaderå°±æ˜¯BootClassLoaderï¼Œè¿™ä¸ªå…·ä½“ä»£ç æˆ‘æ²¡å»æ‰¾ï¼Œå¯ä»¥ç®€å•çš„æ‰“å°ä¸‹æ—¥å¿—å°±èƒ½å‘ç°ï¼Œä¸è¿‡è¿™ä¸ªæƒ…å†µåœ¨instant run çš„æƒ…å†µä¸‹ä¼šæœ‰æ‰€ä¸åŒï¼Œå¤§å®¶å¯ä»¥å»ç ”ç©¶ç ”ç©¶~æœ‰ç‚¹æ‰¯è¿œäº†ï¼Œè¿™é‡Œæˆ‘æƒ³è¯´çš„æ˜¯æˆ‘ä»¬ä¼ å…¥çš„åº”ç”¨ç±»åŠ è½½å™¨ä¸­é€šè¿‡findClassä¹Ÿæ˜¯åŠ è½½ä¸åˆ°æˆ‘ä»¬éœ€è¦çš„ç±»çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯å¾—å»çœ‹æˆ‘ä»¬è‡ªå®šä¹‰çš„DexClassLoaderä¸­çš„findClassæ–¹æ³•ï¼ŒDexClassLoaderä¸­è¿˜æ˜¯æ²¡æœ‰é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆè¿˜æ˜¯å»BaseDexClassLoaderä¸­çœ‹å§ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  	@Override
    protected Class&amp;lt;?&amp;gt; findClass(String name) throws ClassNotFoundException {
        Class clazz = pathList.findClass(name);
        if (clazz == null) {
            throw new ClassNotFoundException(name);
        }
        return clazz;
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;è¿˜è®°å¾—æˆ‘ä»¬çš„pathListå—ï¼Ÿä¸è®°å¾—å›å¤´çœ‹çœ‹ä¸Šé¢çš„å›¾ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  	public Class findClass(String name) {
        for (Element element : dexElements) {
            DexFile dex = element.dexFile;
            if (dex != null) {
                Class clazz = dex.loadClassBinaryName(name, definingContext);
                if (clazz != null) {
                    return clazz;
                }
            }
        }
        return null;
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Elementæ˜¯ä¸æ˜¯ä¹Ÿå¾ˆç†Ÿæ‚‰ï¼Ÿå°±æ˜¯é‚£ä¸ªç®€å•çš„å®ä½“ç±»ï¼Œæ‰€ä»¥ç»§ç»­åˆ°DexFileä¸­å»çœ‹dex.loadClassBinaryNameæ–¹æ³•ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; 	public Class loadClassBinaryName(String name, ClassLoader loader) {
        return defineClass(name, loader, mCookie);
    }
    private native static Class defineClass(String name, ClassLoader loader, int cookie);

&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;æœ€ç»ˆä½¿ç”¨äº†nativeæ–¹æ³•defineClasså»åŠ è½½æˆ‘ä»¬éœ€è¦çš„ç±»ï¼Œæ³¨æ„å‚æ•°é‡Œæœ‰ä¸ªmCookieï¼Œå®ƒå°±æ˜¯openDexFileæ–¹æ³•è¿”å›çš„dexæ–‡ä»¶è¿”å›çš„intå€¼ï¼Œè¿™æ ·å°±å°†æˆ‘ä»¬éœ€è¦åŠ è½½çš„ç±»å’Œæˆ‘ä»¬çš„dexæ–‡ä»¶å¯¹åº”èµ·æ¥äº†ï¼Œå»ä»æˆ‘ä»¬ç»™å®šçš„dexæ–‡ä»¶ä¸­å»åŠ è½½æˆ‘ä»¬éœ€è¦çš„ç±»ã€‚&lt;/p&gt;

&lt;p&gt;è‡³æ­¤ï¼Œæˆ‘ä»¬çš„åŠ è½½è¿‡ç¨‹å°±å¾ˆæ¸…æ¥šäº†ã€‚æœ¬æ–‡æ‰€æåŠçš„å†…å®¹å¹¶æ²¡æœ‰ä»€ä¹ˆæŠ€æœ¯å«é‡ï¼Œåªæ˜¯é¡ºç€ä¸€æ¡ä¸»çº¿æ¢³ç†äº†ä¸‹æ•´ä¸ªè¿‡ç¨‹ï¼Œå¯¹äºææ˜ç™½ä¸€äº›ç»†èŠ‚å¯èƒ½è¿˜æ˜¯æœ‰ç‚¹å¸®åŠ©ã€‚é¡ºå¸¦è¯´ä¸€ä¸‹ï¼Œå…¶å®çƒ­ä¿®å¤ä¹Ÿæ˜¯ç”¨åˆ°äº†è¿™ä¸ªåŠ è½½æœºåˆ¶ï¼ŒåŠ¨æ€çš„æ›¿æ¢æ‰æœ‰bugçš„ç±»ï¼Œå› ä¸ºå·²ç»è¢«åŠ è½½è¿‡çš„ç±»ä¸ä¼šå†è¢«åŠ è½½ï¼Œæ‰€ä»¥åªè¦æˆ‘ä»¬æŠŠä¿®å¤bugåçš„ç±»æ”¾åˆ°æœ‰bugé‚£ä¸ªç±»ä¹‹å‰åŠ è½½ï¼Œå°±èƒ½è§£å†³é—®é¢˜äº†ã€‚&lt;/p&gt;
</description>
        <pubDate>Fri, 22 Jul 2016 23:10:00 +0800</pubDate>
        <link>http://yourdomain.com/blog/2016/07/22/android%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6.html</link>
        <guid isPermaLink="true">http://yourdomain.com/blog/2016/07/22/android%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6.html</guid>
        
        
        <category>Blog</category>
        
      </item>
    
      <item>
        <title>androidå­¦ä¹ ä¹‹è¿½æ ¹æº¯æº</title>
        <description>&lt;p&gt;å‰å‡ å¤©åœ¨å…¬å¸å°ç»„å†…åšäº†ä¸€ä¸ªandroidæ’ä»¶åŒ–çš„æŠ€æœ¯åˆ†äº«ï¼Œç„¶åè¢«æˆ‘ä»¬jerryå¤§å¤§è¿½æ€ç€è¦ä¸€ç¯‡åˆ†äº«ï¼Œç„¶åæˆ‘å°±ç¢ç£¨ç€æ€ä¹ˆå†™ï¼Œéš¾é“è¦æŠŠè¿™ä¹ˆå¤§ä¸€ä¸ªä¸»é¢˜ç”¨ä¸€ç¯‡æ–‡ç« å†™å®Œï¼Ÿæ„Ÿè§‰ä¸ç°å®ï¼Œå†µä¸”æœ¬èº«æˆ‘ç°åœ¨è¿˜åœ¨æ‹œè¯»äººå®¶çš„ä»£ç ä¸­ï¼Œä¹Ÿæ²¡è¿™ä¸ªè‡ªä¿¡èƒ½æŠŠæ‰€æœ‰ç»†èŠ‚éƒ½ç†è§£é€ï¼Œè§£é‡Šæ¸…æ¥šï¼Œæ‰€ä»¥å†ä¸‰è€ƒè™‘è¿˜æ˜¯å†³å®šä¸è¯¯äººå­å¼Ÿäº†â€¦â€¦&lt;/p&gt;

&lt;p&gt;ä¸è¿‡ä¸ºäº†åšè¿™ä¸ªåˆ†äº«ï¼Œæˆ‘è‡ªå·±å€’æ˜¯å­¦åˆ°äº†è®¸å¤šã€‚å› ä¸ºè¦ç»™åˆ«äººåˆ†äº«ï¼Œé‚£è‚¯å®šä¸èƒ½çæ‰¯å•Šï¼Œåˆ«äººæœ‰ç–‘é—®é‚£è‚¯å®šå¾—è§£é‡Šåˆ°ä½å•Šï¼Œå¯¹äºæŸäº›å…·ä½“çš„ç»†èŠ‚ä¸èƒ½å…¨é çŒœå•Šï¼Œå’±å¾—è®²è¯æ®å•Šï¼Œæ‰€ä»¥å‘¢ï¼Œåªèƒ½é€¼ç€è‡ªå·±å»æ’¸åˆ«äººçš„ä»£ç ï¼Œæ’¸ç€æ’¸ç€å‘ç°æ’¸ä¸åŠ¨äº†ï¼Œä¸€äº›åœ°æ–¹çœ‹ä¸æ‡‚ï¼Œçœ‹ç€å¥½åƒæ˜¯å¹²å˜›çš„ï¼Œä½†åˆä¸ç¡®å®šã€‚å¦‚æœæ˜¯å¹³å¸¸ï¼Œå¯èƒ½ä¹Ÿå°±è¿™ä¹ˆè¿‡å»äº†ï¼Œåæ­£å¤§è‡´ä¸Šèƒ½æ˜ç™½æ€ä¹ˆå›äº‹ï¼Œä½†è¿™æ¬¡ä¸ºäº†åˆ†äº«ï¼Œå¾—è®²å¾—å‡ºä¸ªæ‰€ä»¥ç„¶ï¼Œä¹Ÿå°±ç¡¬ç€å¤´çš®ç»§ç»­ç ”ç©¶ä¸‹å»ã€‚è¿™æ ·ï¼Œå¾€å¾€ä¼šå­¦åˆ°å…¶ä»–æ–°çš„çŸ¥è¯†ï¼Œæ¯”å¦‚èµ„æºåŠ è½½æœºåˆ¶ã€åº”ç”¨ç¨‹åºå’Œç³»ç»ŸæœåŠ¡ä¹‹é—´çš„äº¤äº’æ¨¡å¼ã€åŠ¨æ€ä»£ç†ã€activityçš„å¯åŠ¨è¿‡ç¨‹ã€å¹¿æ’­æ³¨å†Œç»†èŠ‚ç­‰ç­‰ï¼Œå…¶å®è¿™äº›å†…å®¹å³ä½¿ä¸çŸ¥é“ï¼Œä¹Ÿæ˜¯èƒ½æ¼‚äº®çš„å®Œæˆä¸€ä¸ªappçš„å¼€å‘çš„ï¼Œæ¯•ç«Ÿå¤§éƒ¨åˆ†æ—¶å€™æˆ‘ä»¬ç”¨ä¸ä¸Šè¿™äº›ä¸œè¥¿ã€‚ä½†ä¸€ç›´è¿™ä¹ˆä¸‹å»ï¼Œä¹Ÿè®¸ä½ å°±ä¸€ç›´ä»…é™äºåšä¸€äº›å¤Ÿç”¨çš„appï¼Œè€Œä¸æ˜¯ä¸€äº›å¥½ç”¨çš„äº§å“ï¼Œè€Œä¸”éšä¾¿ä¸€ä¸ªåŸ¹è®­æœºæ„å‡ºæ¥çš„å°ä¼™å°±èƒ½æŠŠä½ æ›¿æ¢äº†ï¼Œå®Œå…¨æ²¡æœ‰è‡ªå·±çš„ç«äº‰åŠ›ã€‚&lt;/p&gt;

&lt;p&gt;æ‰€ä»¥å‘¢ï¼Œè¯´çš„ç°å®ç‚¹ï¼Œä¸ºäº†è‡ªå·±çš„é’±é€”ï¼Œæˆ‘è§‰å¾—ä¹Ÿä¸åº”è¯¥æ­¢æ­¥äºè¡¨é¢ã€‚å…³äºè¿™ä¸€ç‚¹ï¼Œå…¶å®ä»ç¨‹åºå‘˜è§£å†³bugçš„æ–¹å¼å°±å¾ˆå®¹æ˜“çœ‹å‡ºæ¥ï¼Œæ¯”å¦‚è¯´æœ€å¸¸è§çš„NullPointExceptionï¼Œæœ€ç®€å•å¿«æ·çš„è§£å†³åŠæ³•å°±æ˜¯ç»™å‡ºé”™çš„ä»£ç åŠ ä¸Šéç©ºåˆ¤æ–­ï¼Œä»¥å‰æˆ‘å°±æ˜¯è¿™ä¹ˆåšçš„ï¼Œç„¶åè¿‡å‡ å¤©å¦ä¸€ä¸ªåœ°æ–¹åˆå‡ºç°ç©ºæŒ‡é’ˆï¼Œé‚£å°±å†æ¥ä¸€éå‘—ã€‚å°±è¿™æ ·ï¼Œè¿˜åœ¨ä¸ºè‡ªå·±è§£å†³é—®é¢˜çš„èƒ½åŠ›å’Œæ•ˆç‡æ²¾æ²¾è‡ªå–œã€‚æ®Šä¸çŸ¥ï¼Œä¹Ÿè®¸åªè¦æŠŠæºå¤´æ‰¾åˆ°ï¼Œè¿™ä¸€ç³»åˆ—é—®é¢˜å°±éƒ½ä¸ä¼šå†å‡ºç°äº†ï¼Œè¿™æ‰å«è§£å†³bugï¼Œæ‰æ˜¯æœ‰æ„ä¹‰çš„ä»£ç ï¼Œè€Œä¸æ˜¯æ— è°“çš„åŠ åˆ¤æ–­ã€‚å½“ç„¶ï¼Œè¿™ä¸ªæ‰¾æºå¤´çš„è¿‡ç¨‹å¯èƒ½å¹¶ä¸è½»æ¾ï¼Œä½†ä¹Ÿæ­£æ˜¯è¿™æ ·æ‰èƒ½ä½“ç°ä½ çš„èƒ½åŠ›ã€‚&lt;/p&gt;

&lt;p&gt;è¿™äº›ä¹Ÿå¾—æ„Ÿè°¢ç°åœ¨çš„è€å¤§ï¼Œåœ¨ä¸æ–­çš„è¢«è¿½é—®å¯¼è‡´è¿™ä¸ªbugçš„åŸå› æ˜¯ä»€ä¹ˆçš„è¿‡ç¨‹ä¸­ï¼Œè®©æˆ‘è¦æˆäº†è¿½æ ¹æº¯æºçš„ä¹ æƒ¯ï¼Œè€Œä¸”ï¼Œåœ¨æ‰¾åŸå› çš„è¿‡ç¨‹ç»å¸¸ä¼šå‘ç°ä¸€äº›ä¸çŸ¥é“çš„ç»†èŠ‚ã€‚æ‰€ä»¥ï¼Œæ²¡äº‹å¤šé—®é—®è‡ªå·±ä¸ºä»€ä¹ˆå‡ºé”™ï¼Œå¹¶ä¸”æ‰¾å‡ºé‚£ä¸ªç½ªæ¶ä¹‹æºï¼&lt;/p&gt;
</description>
        <pubDate>Mon, 02 May 2016 23:10:00 +0800</pubDate>
        <link>http://yourdomain.com/blog/2016/05/02/android%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%BF%BD%E6%A0%B9%E6%BA%AF%E6%BA%90.html</link>
        <guid isPermaLink="true">http://yourdomain.com/blog/2016/05/02/android%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%BF%BD%E6%A0%B9%E6%BA%AF%E6%BA%90.html</guid>
        
        
        <category>Blog</category>
        
      </item>
    
  </channel>
</rss>
